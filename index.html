<!doctype html>
<html lang="ru" data-theme="dark">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Elementix ‚Äî Mini Alchemy (v1.8.0)</title>
<meta name="theme-color" content="#0b0e14">
<link rel="preconnect" href="https://telegram.org">
<script src="https://telegram.org/js/telegram-web-app.js"></script>
<style>
/* =========================
   BASE + THEME TOKENS
   ========================= */
:root{
  /* –±–∞–∑–æ–≤—ã–µ —Ç–æ–∫–µ–Ω—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è —Ç–µ–º–∞–º–∏) */
  --bg:#0b0e14;--panel:#0f1420;--card:#0e121b;--text:#e6e9f2;--muted:#9aa3b2;
  --border:#223047;--accent:#7cc4ff;--ok:#22c55e;--warn:#f59e0b;--err:#ef4444;
  --chip:#0f172a;--glass:rgba(255,255,255,.05);

  /* –∞–Ω–∏–º–∞—Ü–∏–∏ */
  --fade-in: .5s cubic-bezier(.22,.61,.36,1);
  --float-shadow: 0 12px 30px rgba(0,0,0,.24);
}

/* ---------- DARK: –ú—è–≥–∫–∏–π –Ω–µ–æ–Ω ---------- */
html[data-theme="dark"]{
  --bg:#0e1330;
  --panel:#111a3a;
  --card:#121b3f;
  --text:#f2f6ff;
  --muted:#b5c3e4;
  --border:#32487a;
  --accent:#8fd0ff;
  --chip:#0f1637;
  --glass: rgba(255,255,255,.06);
}

/* ---------- LIGHT: –¢—ë–ø–ª—ã–π –¥–Ω–µ–≤–Ω–æ–π ---------- */
html[data-theme="light"]{
  --bg:#f5f7fa;
  --panel:#ffffff;
  --card:#ffffff;
  --text:#1c1f26;
  --muted:#5b6473;
  --border:#e0e6ee;
  --accent:#6ba4ff;
  --chip:#f2f5fb;
  --glass: rgba(0,0,0,.03);
}

/* =========================
   GLOBALS + BACKGROUND
   ========================= */
*{box-sizing:border-box}
html,body{height:100%}
html{scroll-behavior:smooth}
body{
  margin:0;
  background:
    radial-gradient(1200px 800px at 10% -10%, rgba(120,197,255,.20) 0%, transparent 60%),
    radial-gradient(900px 600px at 110% 40%, rgba(180,140,255,.16) 0%, transparent 60%),
    linear-gradient(180deg, var(--bg), #0b1128 120%);
  color:var(--text);
  font:16px/1.45 system-ui,-apple-system,Segoe UI,Roboto,Arial;
  -webkit-font-smoothing:antialiased;
  -moz-osx-font-smoothing:grayscale;

  /* –ø–ª–∞–≤–Ω–∞—è –ª—ë–≥–∫–∞—è –∞–Ω–∏–º–∞—Ü–∏—è —Ñ–æ–Ω–∞ (–≤ dark –∑–∞–º–µ—Ç–Ω–µ–µ) */
  background-size: 120% 120%;
  animation: bgMove 26s ease-in-out infinite alternate;
}
@keyframes bgMove{
  0%{ background-position: 0% 0%, 100% 0%, 50% 0% }
  50%{ background-position: 50% 30%, 80% 50%, 50% 0% }
  100%{ background-position: 100% 60%, 60% 80%, 50% 0% }
}

/* LIGHT: –¥–µ–ª–∞–µ–º —Ñ–æ–Ω —Å–ø–æ–∫–æ–π–Ω–µ–µ */
html[data-theme="light"] body{
  background:
    radial-gradient(1200px 800px at 10% -10%, rgba(112,170,255,.14) 0%, transparent 60%),
    radial-gradient(900px 600px at 110% 40%, rgba(255,185,140,.15) 0%, transparent 60%),
    linear-gradient(180deg, var(--bg), #e7eef6 120%);
}

.wrap{max-width:820px;margin:0 auto;padding:10px calc(12px + env(safe-area-inset-right)) calc(150px + env(safe-area-inset-bottom)) calc(12px + env(safe-area-inset-left));display:grid;gap:12px}
header{
  position:sticky;top:0;z-index:50;backdrop-filter:saturate(120%) blur(8px);
  background:linear-gradient(180deg, rgba(2,6,23,.6), rgba(2,6,23,0));
  border-bottom:1px solid rgba(255,255,255,.04);
}
html[data-theme="light"] header{
  background:linear-gradient(180deg, rgba(255,255,255,.85), rgba(255,255,255,0));
  border-bottom:1px solid var(--border);
}

.hrow{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:8px 10px}
.brand{display:flex;align-items:center;gap:10px}
.logo{width:38px;height:38px;border-radius:12px;display:grid;place-items:center;background:conic-gradient(from 180deg at 60% 40%,#86e3ff, #69f7c2, #c9afff, #86e3ff);filter:saturate(120%) brightness(1.08);position:relative}
.logo:after{content:"";position:absolute;inset:0;border-radius:12px;border:1px solid rgba(255,255,255,.15);box-shadow:inset 0 0 20px rgba(0,0,0,.25)}
.title{font-weight:900;letter-spacing:.3px}
.sub{opacity:.75;font-size:12px}

.pill{padding:6px 10px;border:1px solid var(--border);border-radius:999px;background:rgba(255,255,255,.04)}
html[data-theme="light"] .pill{background:rgba(0,0,0,.03)}

.panel{
  background: linear-gradient(180deg, var(--glass), rgba(255,255,255,.02));
  border:1px solid var(--border);
  border-radius:16px;padding:12px;box-shadow:var(--float-shadow);
}

/* –ø–æ—è–≤–ª–µ–Ω–∏–µ –ø–∞–Ω–µ–ª–µ–π */
.panel{opacity:0; transform:translateY(6px); animation: fadeUp var(--fade-in) forwards}
@keyframes fadeUp{to{opacity:1; transform:none}}

.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
.grid{display:grid;gap:10px;grid-template-columns:repeat(2,1fr)}
@media (min-width:560px){ .grid{grid-template-columns:repeat(3,1fr)} }
@media (min-width:900px){ .grid{grid-template-columns:repeat(4,1fr)} }

.btn{appearance:none;border:none;cursor:pointer;
  padding:12px 14px;border-radius:12px;min-height:44px;
  background:linear-gradient(180deg,#121a36,#0f1631);color:var(--text);
  border:1px solid rgba(143,208,255,.25);transition:transform .08s ease, background .2s, opacity .2s, box-shadow .2s;user-select:none;
  box-shadow: 0 6px 18px rgba(25,40,90,.35)
}
.btn:active{transform:translateY(1px)}
.btn.ghost{background:rgba(255,255,255,.04); border:1px solid rgba(143,208,255,.22)}
.btn.success{background:linear-gradient(180deg,#2fe6c9,#17b8a3); border:1px solid rgba(47,230,201,.7); text-shadow:0 1px 0 rgba(0,0,0,.25); box-shadow:0 12px 26px rgba(47,230,201,.35)}
.btn.warn{background:linear-gradient(180deg,#ffc86b,#f59e0b); border:1px solid rgba(255,200,107,.7)}
.btn.icon{width:40px;height:40px;display:grid;place-items:center;padding:0;border-radius:10px}

/* LIGHT-–∫–Ω–æ–ø–∫–∏ */
html[data-theme="light"] .btn{
  background:linear-gradient(180deg,#ffffff,#f3f6fb);
  border:1px solid var(--border);
  box-shadow:0 4px 14px rgba(0,0,0,.06);
  color:#1c1f26;
}
html[data-theme="light"] .btn.ghost{background:#fff}
html[data-theme="light"] .btn.success{background:linear-gradient(180deg,#46e0c8,#21c2a9)}
html[data-theme="light"] .btn.warn{background:linear-gradient(180deg,#ffd889,#f5a23a)}

input[type="search"]{
  flex:1;min-width:180px;padding:11px;border-radius:10px;
  border:1px solid var(--border);background:#0c1230;color:var(--text);
  box-shadow: inset 0 1px 0 rgba(255,255,255,.06)
}
html[data-theme="light"] input[type="search"]{ background:#fff; color:#1c1f26 }

.card{
  display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:14px;cursor:pointer;position:relative;
  background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.03));
  border:1px solid rgba(143,208,255,.22);min-height:56px;overflow:hidden;
  box-shadow: 0 6px 22px rgba(30,60,120,.15);
  transition: transform .16s ease, box-shadow .2s ease, outline-color .2s ease, background .2s ease, opacity .2s ease;
  opacity:0; transform:translateY(6px);
  animation: fadeUp var(--fade-in) forwards;
  animation-delay: var(--delay, 0s);
}
.card:hover{transform: translateY(-2px) scale(1.02); box-shadow: 0 10px 28px rgba(120,197,255,.35); outline:1px solid rgba(143,208,255,.35)}
.card .emoji{font-size:22px;flex:0 0 auto; filter: drop-shadow(0 0 8px rgba(143,208,255,.35))}
.name{font-weight:800;letter-spacing:.2px}
.rar{position:absolute;right:8px;top:8px;font-size:10px;opacity:.9;border:1px solid var(--border);padding:2px 6px;border-radius:999px;background:rgba(8,14,32,.55);color:#cfe6ff}
html[data-theme="light"] .rar{ background:rgba(0,0,0,.05); color:#3a4660 }

.bowls{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.bowl{min-height:90px;border:1px dashed #2a3a56;border-radius:14px;display:flex;align-items:center;justify-content:center;padding:12px;background:#0f1535;color:#9fb3c8;position:relative;text-align:center;
  box-shadow: inset 0 1px 0 rgba(255,255,255,.06), 0 10px 24px rgba(20,30,70,.45)
}
html[data-theme="light"] .bowl{ background:#ffffff; color:#5b6473; border-color: var(--border); box-shadow: inset 0 1px 0 rgba(0,0,0,.03), 0 6px 18px rgba(0,0,0,.06) }

.chip{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border-radius:999px;background:var(--chip);border:1px solid var(--border);font-weight:700}
.chip span{ font-size:18px; filter: drop-shadow(0 0 6px rgba(143,208,255,.35)) }

.empty{padding:18px;border:1px dashed var(--border);border-radius:12px;text-align:center;color:var(--muted)}
.toast{position:fixed;left:50%;top:10px;transform:translateX(-50%);background:#0f1420;border:1px solid var(--border);border-radius:10px;padding:8px 12px;display:none;z-index:200}
.toast.show{display:block}
.badge{padding:6px 10px;border-radius:999px;border:1px solid var(--border);background:rgba(255,255,255,.04);font-size:12px}

.dock{position:fixed;left:50%;transform:translateX(-50%);bottom:calc(78px + env(safe-area-inset-bottom));z-index:55;
  display:grid;grid-template-columns:1fr 1fr;gap:10px;align-items:center;
  background:rgba(10,18,40,.7);backdrop-filter:blur(10px) saturate(120%);
  border:1px solid var(--border);padding:10px;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.35);width:min(92vw,720px)}
.dock .btn{width:100%}
@media (max-width:360px){ .dock{grid-template-columns:1fr;row-gap:8px} }
html[data-theme="light"] .dock{
  background: rgba(255,255,255,.85);
  box-shadow: 0 10px 24px rgba(0,0,0,.08);
}

/* floating hint */
.fab-hint{position:fixed;left:14px;bottom:calc(78px + env(safe-area-inset-bottom) + 66px);z-index:56;
  display:flex;align-items:center;gap:10px;padding:10px 12px;border-radius:14px;border:1px solid var(--border);
  background:linear-gradient(180deg,#1d2a5a,#0f1636);box-shadow:0 8px 24px rgba(0,0,0,.35);max-width:60vw}
.fab-hint .bulb{width:24px;height:24px;border-radius:7px;display:grid;place-items:center;background:linear-gradient(180deg,#eab308,#f59e0b);box-shadow:0 0 16px rgba(245,158,11,.35)}
.fab-hint .txt{font-weight:700;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
html[data-theme="light"] .fab-hint{
  background:#fff;
  box-shadow:0 8px 16px rgba(0,0,0,.08);
}

/* footer reset */
footer{position:fixed;left:0;right:0;bottom:0;padding:8px 12px calc(8px + env(safe-area-inset-bottom));display:flex;justify-content:center;background:linear-gradient(180deg, transparent, rgba(2,6,23,.6));z-index:50}
.reset-wrap{display:flex;gap:10px;align-items:center;border:1px dashed var(--border);background:rgba(255,255,255,.02);padding:8px 10px;border-radius:12px}
.devnote{opacity:.8;font-size:12px}
html[data-theme="light"] footer{ background:linear-gradient(180deg, transparent, rgba(255,255,255,.8)) }

/* modal (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π) */
.modal{position:fixed;inset:0;display:none;align-items:flex-end;justify-content:center;background:rgba(0,0,0,.4);z-index:300}
.modal.show{display:flex}
.sheet{width:100%;max-width:820px;background:#0f1420;border:1px solid var(--border);border-radius:18px 18px 0 0;padding:14px 14px 24px;box-shadow:0 -10px 30px rgba(0,0,0,.35)}
.sheet h3{margin:0 0 8px}
.sheet .opt{display:flex;align-items:center;justify-content:space-between;border:1px solid var(--border);border-radius:14px;padding:12px;margin-top:10px;background:rgba(255,255,255,.02)}
.sheet .opt small{opacity:.7}
.sheet .opt .btn{min-width:110px}

/* hint pretty */
.hint-card{border:1px solid var(--border);background:radial-gradient(1000px 500px at -20% -50%,rgba(124,196,255,.12),transparent 60%),rgba(255,255,255,.02);padding:12px;border-radius:14px;box-shadow:0 10px 30px rgba(0,0,0,.25)}
.hint-row{display:flex;align-items:center;gap:10px;flex-wrap:nowrap;overflow:auto}
.hint-row .eq{opacity:.6;margin:0 4px}
.hint-head{display:flex;align-items:center;gap:8px;margin-bottom:6px}
.hint-bulb{width:28px;height:28px;border-radius:8px;display:grid;place-items:center;background:linear-gradient(180deg,#eab308,#f59e0b);box-shadow:0 0 16px rgba(245,158,11,.35)}
.center{display:flex;justify-content:center;margin-top:10px}

/* =========================
   FACT MODAL (–Ω–æ–≤—ã–π)
   ========================= */
.fact-modal{position:fixed;inset:0;display:none;place-items:center;background:rgba(0,0,0,.55);z-index:450}
.fact-modal.show{display:grid}
.fact-card{
  width:min(92vw,560px);
  background: linear-gradient(180deg, rgba(255,255,255,.08), rgba(255,255,255,.04));
  border:1px solid rgba(143,208,255,.38);
  border-radius:18px;
  padding:18px 16px 16px;
  box-shadow: 0 24px 70px rgba(12,20,45,.65);
  animation: pop .35s cubic-bezier(.2,.8,.2,1);
}
@keyframes pop{
  from{opacity:.0; transform: translateY(10px) scale(.98)}
  to{opacity:1; transform: none}
}
html[data-theme="light"] .fact-card{
  background:#ffffff;
  border:1px solid var(--border);
  box-shadow: 0 24px 70px rgba(0,0,0,.12);
}
.fact-title{display:flex;align-items:center;gap:10px;margin-bottom:8px}
.fact-emoji{font-size:26px; filter: drop-shadow(0 0 8px rgba(143,208,255,.35))}
.fact-name{font-weight:900;letter-spacing:.2px;font-size:18px}
.fact-text{opacity:.95;line-height:1.55;margin:8px 0 14px}
.fact-actions{display:flex;justify-content:flex-end}
</style>
</head>
<body>
<header>
  <div class="hrow">
    <div class="brand">
      <div class="logo"></div>
      <div>
        <div class="title">Elementix</div>
        <div class="sub" id="tgUser">–ò–≥—Ä–æ–∫: ... ¬∑ <span class="version">v1.8.0</span></div>
      </div>
    </div>
    <div class="row">
      <span class="pill">‚≠ê <b id="stars">0</b></span>
      <button class="btn ghost" id="btnShop">–ú–∞–≥–∞–∑–∏–Ω</button>
      <button class="btn icon" id="btnShare" title="–ü–æ–¥–µ–ª–∏—Ç—å—Å—è">üîó</button>
      <!-- –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å —Ç–µ–º—ã -->
      <button class="btn icon" id="btnTheme" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üåô</button>
    </div>
  </div>
</header>

<main class="wrap" id="root">

  <section class="panel">
    <div class="row" style="justify-content:space-between;gap:8px">
      <div class="row">
        <button class="btn ghost" id="btnQuests">–ó–∞–¥–∞–Ω–∏—è</button>
      </div>
      <small id="themeDbg" class="sub"></small>
    </div>
  </section>

  <section class="panel">
    <div class="bowls">
      <div class="bowl" id="bowlA"><span class="sub">–í—ã–±–µ—Ä–∏ —ç–ª–µ–º–µ–Ω—Ç‚Ä¶</span></div>
      <div class="bowl" id="bowlB"><span class="sub">‚Ä¶–∏ –≤—Ç–æ—Ä–æ–π</span></div>
    </div>
  </section>

  <section class="panel">
    <div class="row" style="justify-content:space-between;gap:10px">
      <div class="pill">–û—Ç–∫—Ä—ã—Ç–æ: <b id="discCount">0</b> / <b id="totalCount">0</b></div>
      <input id="search" type="search" placeholder="–ü–æ–∏—Å–∫">
    </div>
    <div class="grid" id="cards" style="margin-top:10px"></div>
    <div id="emptyState" class="empty" style="display:none">–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ</div>
  </section>

</main>

<!-- floating hint -->
<div class="fab-hint" id="fabHint"><div class="bulb">üí°</div><div class="txt">–ü–æ–¥—Å–∫–∞–∑–∫–∞</div></div>

<!-- Action Dock -->
<div class="dock">
  <button class="btn success" id="btnMixDock">ü•£ –°–º–µ—à–∞—Ç—å</button>
  <button class="btn" id="btnClearDock">üßπ –û—á–∏—Å—Ç–∏—Ç—å</button>
</div>

<footer>
  <div class="reset-wrap">
    <button class="btn" id="btnReset">–°–±—Ä–æ—Å</button>
    <span class="devnote">–∫—Ç–æ –Ω–∞–∂–º—ë—Ç ‚Äî –º–∏–Ω—É—Å –º–∞—Ç—å</span>
  </div>
</footer>

<div id="toast" class="toast"></div>

<!-- Modal (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π) -->
<div class="modal" id="modal">
  <div class="sheet" id="sheet"></div>
</div>

<!-- FACT MODAL (–Ω–æ–≤—ã–π, —Ç–æ–ª—å–∫–æ —Ä—É—á–Ω–æ–µ –∑–∞–∫—Ä—ã—Ç–∏–µ) -->
<div class="fact-modal" id="factModal" aria-modal="true" role="dialog">
  <div class="fact-card" id="factCard">
    <div class="fact-title">
      <div class="fact-emoji" id="factEmoji">‚ú®</div>
      <div class="fact-name" id="factName">–ù–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç!</div>
    </div>
    <div class="fact-text" id="factText">–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ñ–∞–∫—Ç‚Ä¶</div>
    <div class="fact-actions">
      <button class="btn success" id="factOk">–û–∫–µ–π</button>
    </div>
  </div>
</div>

<script>
/* ---------- Telegram WebApp & Theme ---------- */
const tg = window.Telegram?.WebApp;
if (tg){
  tg.ready(); tg.expand();
  applyTheme(tg.themeParams);
  tg.onEvent('themeChanged', ()=> applyTheme(tg.themeParams));
}
function applyTheme(p){
  if(!p) return; const css = document.documentElement.style;
  if (p.bg_color) css.setProperty('--bg', p.bg_color);
  if (p.secondary_bg_color) css.setProperty('--panel', p.secondary_bg_color);
  if (p.text_color) css.setProperty('--text', p.text_color);
  if (p.hint_color) css.setProperty('--muted', p.hint_color);
  if (p.link_color) css.setProperty('--accent', p.link_color);
  if (p.button_color) css.setProperty('--border', p.button_color + '40');
  document.getElementById('themeDbg').textContent = tg?.colorScheme ? ('theme: ' + tg.colorScheme) : '';
}

/* ---------- Elements & Recipes (same subset) ---------- */
const E = (id, name, emoji, rar='Common') => ({id,name,emoji,rar});
const ELEMENTS=[
  E('air','–í–æ–∑–¥—É—Ö','üí®'), E('earth','–ó–µ–º–ª—è','üå±'), E('fire','–û–≥–æ–Ω—å','üî•'), E('water','–í–æ–¥–∞','üíß'),
  E('steam','–ü–∞—Ä','‚ô®Ô∏è'), E('stone','–ö–∞–º–µ–Ω—å','ü™®'), E('dust','–ü—ã–ª—å','üå´Ô∏è'), E('lava','–õ–∞–≤–∞','üåã','Uncommon'),
  E('energy','–≠–Ω–µ—Ä–≥–∏—è','‚ö°','Uncommon'), E('rain','–î–æ–∂–¥—å','üåßÔ∏è'), E('mud','–ì—Ä—è–∑—å','üü´'),
  E('sand','–ü–µ—Å–æ–∫','üèñÔ∏è'), E('glass','–°—Ç–µ–∫–ª–æ','üß™','Uncommon'), E('metal','–ú–µ—Ç–∞–ª–ª','üõ†Ô∏è','Uncommon'),
  E('electricity','–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ','üîå','Rare'), E('sea','–ú–æ—Ä–µ','üåä'), E('ocean','–û–∫–µ–∞–Ω','üåä','Uncommon'),
  E('river','–†–µ–∫–∞','üèûÔ∏è'), E('lake','–û–∑–µ—Ä–æ','üõ∂'), E('plant','–†–∞—Å—Ç–µ–Ω–∏–µ','üåø'), E('tree','–î–µ—Ä–µ–≤–æ','üå≥','Uncommon'),
  E('coal','–£–≥–æ–ª—å','ü™µ'), E('oil','–ù–µ—Ñ—Ç—å','üõ¢Ô∏è','Uncommon'), E('pressure','–î–∞–≤–ª–µ–Ω–∏–µ','üéõÔ∏è'),
  E('time','–í—Ä–µ–º—è','‚è≥','Rare'), E('life','–ñ–∏–∑–Ω—å','üß¨','Epic'),
  E('bacteria','–ë–∞–∫—Ç–µ—Ä–∏—è','ü¶†'), E('fish','–†—ã–±–∞','üêü'), E('animal','–ñ–∏–≤–æ—Ç–Ω–æ–µ','üêæ','Uncommon'),
  E('bird','–ü—Ç–∏—Ü–∞','üê¶'), E('human','–ß–µ–ª–æ–≤–µ–∫','üßç','Rare'),
  E('tool','–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç','ü™ì'), E('wheel','–ö–æ–ª–µ—Å–æ','üõû'), E('cart','–¢–µ–ª–µ–≥–∞','üõí'),
  E('sandstorm','–ü–µ—Å—á–∞–Ω–∞—è –±—É—Ä—è','üå™Ô∏è'), E('storm','–®—Ç–æ—Ä–º','üå™Ô∏è','Uncommon'),
  E('cloud','–û–±–ª–∞–∫–æ','‚òÅÔ∏è'), E('sky','–ù–µ–±–æ','üåå'), E('sun','–°–æ–ª–Ω—Ü–µ','‚òÄÔ∏è','Uncommon'), E('moon','–õ—É–Ω–∞','üåô','Uncommon'),
  E('brick','–ö–∏—Ä–ø–∏—á','üß±'), E('house','–î–æ–º','üè†','Uncommon'), E('city','–ì–æ—Ä–æ–¥','üèôÔ∏è','Rare'),
  E('computer','–ö–æ–º–ø—å—é—Ç–µ—Ä','üíª','Epic'), E('electricity_gen','–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä','üîã','Uncommon'),
  E('sandglass','–ü–µ—Å–æ—á–Ω—ã–µ —á–∞—Å—ã','‚åõ','Uncommon'), E('glass_sandwich','–°—Ç–µ–∫–ª–æ–ø–∞–∫–µ—Ç','ü™ü','Uncommon'),
  E('ash','–ü–µ–ø–µ–ª','üß´'), E('smoke','–î—ã–º','üí®','Uncommon'), E('alcohol','–ê–ª–∫–æ–≥–æ–ª—å','üç∑','Uncommon'),
  E('bread','–•–ª–µ–±','üçû'), E('dough','–¢–µ—Å—Ç–æ','ü•ñ'), E('flour','–ú—É–∫–∞','üåæ'),
  E('energy_drink','–≠–Ω–µ—Ä–≥–µ—Ç–∏–∫','ü•§','Rare'), E('robot','–†–æ–±–æ—Ç','ü§ñ','Epic')
];
const R = (...a)=>a.sort().join('|');
const RECIPES = new Map([
  [R('fire','water'),'steam'], [R('air','earth'),'dust'], [R('earth','water'),'mud'],
  [R('fire','earth'),'lava'], [R('air','water'),'rain'], [R('rain','earth'),'plant'],
  [R('plant','time'),'tree'], [R('pressure','plant'),'coal'], [R('time','coal'),'oil'],
  [R('water','water'),'sea'], [R('sea','sea'),'ocean'], [R('sand','fire'),'glass'],
  [R('stone','fire'),'metal'], [R('energy','metal'),'electricity'], [R('air','sand'),'sandstorm'],
  [R('steam','air'),'cloud'], [R('cloud','air'),'sky'],
  [R('plant','water'),'algae'], [R('algae','time'),'bacteria'], [R('bacteria','water'),'fish'],
  [R('fish','time'),'animal'], [R('animal','time'),'human'], [R('human','tool'),'house'],
  [R('brick','brick'),'wall'], [R('sand','pressure'),'stone'], [R('lava','water'),'stone'],
  [R('glass','air'),'glass_sandwich'], [R('sand','time'),'sandglass'], [R('fire','plant'),'ash'],
  [R('fire','air'),'smoke'], [R('plant','tool'),'flour'], [R('flour','water'),'dough'],
  [R('dough','fire'),'bread'], [R('energy','water'),'energy_drink'],
  [R('electricity','metal'),'computer'], [R('energy','metal'),'electricity_gen'],
  [R('electricity','tool'),'robot']
]);

/* ---------- Fun facts (–∫–æ—Ä–æ—Ç–∫–∏–µ, –¥—Ä—É–∂–µ–ª—é–±–Ω—ã–µ) ---------- */
const FACTS = {
  air: '–í–æ–∑–¥—É—Ö –Ω–∞ 78% —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –∞–∑–æ—Ç–∞ ‚Äî –æ–Ω –ø–æ—á—Ç–∏ –Ω–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç, –∑–∞—Ç–æ –¥–µ–ª–∞–µ—Ç –∞—Ç–º–æ—Å—Ñ–µ—Ä—É —Å—Ç–∞–±–∏–ª—å–Ω–æ–π.',
  earth: '–í –≤–µ—Ä—Ö–Ω–µ–º —Å–ª–æ–µ –ø–æ—á–≤—ã –∂–∏–≤—ë—Ç –±–æ–ª—å—à–µ –æ—Ä–≥–∞–Ω–∏–∑–º–æ–≤, —á–µ–º –ª—é–¥–µ–π –Ω–∞ –ó–µ–º–ª–µ.',
  fire: '–û–≥–æ–Ω—å ‚Äî —ç—Ç–æ —Ö–∏–º–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–∫—Ü–∏—è –æ–∫–∏—Å–ª–µ–Ω–∏—è, —Å–≤–µ—Ç –∏ —Ç–µ–ø–ª–æ –¥–∞—é—Ç —Ä–∞—Å–∫–∞–ª—ë–Ω–Ω—ã–µ —á–∞—Å—Ç–∏—Ü—ã.',
  water: '–í–æ–¥–∞ –ø–æ–∫—Ä—ã–≤–∞–µ—Ç ~71% –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ –ó–µ–º–ª–∏ –∏ –º–æ–∂–µ—Ç –±—ã—Ç—å –∂–∏–¥–∫–æ–π –≤ –¥–∏–∞–ø–∞–∑–æ–Ω–µ 0‚Äì100¬∞C –ø—Ä–∏ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–º –¥–∞–≤–ª–µ–Ω–∏–∏.',
  steam: '–ü–∞—Ä –±—ã–ª —Å–µ—Ä–¥—Ü–µ–º –∏–Ω–¥—É—Å—Ç—Ä–∏–∞–ª—å–Ω–æ–π —Ä–µ–≤–æ–ª—é—Ü–∏–∏ ‚Äî –ø–∞—Ä–æ–≤—ã–µ –º–∞—à–∏–Ω—ã –∏–∑–º–µ–Ω–∏–ª–∏ –º–∏—Ä.',
  stone: '–ì—Ä–∞–Ω–∏—Ç ‚Äî –æ–¥–Ω–∞ –∏–∑ —Å–∞–º—ã—Ö —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã—Ö –ø–æ—Ä–æ–¥ –∫–æ–Ω—Ç–∏–Ω–µ–Ω—Ç–æ–≤.',
  dust: '–ö–æ—Å–º–∏—á–µ—Å–∫–∞—è –ø—ã–ª—å –ø–∞–¥–∞–µ—Ç –Ω–∞ –ó–µ–º–ª—é –µ–∂–µ–¥–Ω–µ–≤–Ω–æ ‚Äî –¥–µ—Å—è—Ç–∫–∏ —Ç–æ–Ω–Ω!',
  lava: '–õ–∞–≤–∞ ‚Äî —Ä–∞—Å–ø–ª–∞–≤–ª–µ–Ω–Ω–∞—è –ø–æ—Ä–æ–¥–∞; —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å 1 200 ¬∞C.',
  energy: '–≠–Ω–µ—Ä–≥–∏—è –Ω–∏–∫—É–¥–∞ –Ω–µ –∏—Å—á–µ–∑–∞–µ—Ç –∏ –Ω–µ –≤–æ–∑–Ω–∏–∫–∞–µ—Ç –∏–∑ –Ω–∏–æ—Ç–∫—É–¥–∞ ‚Äî –æ–Ω–∞ —Ç–æ–ª—å–∫–æ –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è.',
  rain: '–ö—Ä—É–ø–Ω–∞—è –∫–∞–ø–ª—è –¥–æ–∂–¥—è –ø–∞–¥–∞–µ—Ç —Å–æ —Å–∫–æ—Ä–æ—Å—Ç—å—é –æ–∫–æ–ª–æ 9 –º/—Å.',
  mud: '–ì—Ä—è–∑–µ–≤—ã–µ –≤—É–ª–∫–∞–Ω—ã –µ—Å—Ç—å –Ω–µ —Ç–æ–ª—å–∫–æ –Ω–∞ –ó–µ–º–ª–µ ‚Äî –∏—Ö –Ω–∞—Ö–æ–¥–∏–ª–∏ –∏ –Ω–∞ –ú–∞—Ä—Å–µ.',
  sand: '–ü–µ—Å–æ–∫ ‚Äî —Å—Ç—Ä–æ–∏—Ç–µ–ª—å –≤—Å—ë–≥–æ: —Å—Ç–µ–∫–ª–∞, –±–µ—Ç–æ–Ω–∞ –∏ –¥–∞–∂–µ –º–∏–∫—Ä–æ—á–∏–ø–æ–≤ (—á–µ—Ä–µ–∑ –∫—Ä–µ–º–Ω–∏–π).',
  glass: '–°—Ç–µ–∫–ª–æ ‚Äî –∞–º–æ—Ä—Ñ–Ω—ã–π –º–∞—Ç–µ—Ä–∏–∞–ª: —á—Ç–æ-—Ç–æ –º–µ–∂–¥—É –∂–∏–¥–∫–æ—Å—Ç—å—é –∏ —Ç–≤—ë—Ä–¥—ã–º —Ç–≤—ë—Ä–¥—ã–º —Ç–µ–ª–æ–º.',
  metal: '–ñ–µ–ª–µ–∑–æ ‚Äî —Å–∞–º–æ–µ —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω–æ–µ –≤–µ—â–µ—Å—Ç–≤–æ –≤ —è–¥—Ä–µ –ó–µ–º–ª–∏.',
  electricity: '–ú–æ–ª–Ω–∏—è –Ω–∞–≥—Ä–µ–≤–∞–µ—Ç –≤–æ–∑–¥—É—Ö –¥–æ ~30 000 ¬∞C ‚Äî –≥–æ—Ä—è—á–µ–µ –ø–æ–≤–µ—Ä—Ö–Ω–æ—Å—Ç–∏ –°–æ–ª–Ω—Ü–∞.',
  sea: '–°—Ä–µ–¥–Ω—è—è –≥–ª—É–±–∏–Ω–∞ –º–æ—Ä—è ‚Äî –æ–∫–æ–ª–æ 3,7 –∫–º.',
  ocean: '–û–∫–µ–∞–Ω —Ö—Ä–∞–Ω–∏—Ç ~97% –≤—Å–µ–π –≤–æ–¥—ã –Ω–∞ –ø–ª–∞–Ω–µ—Ç–µ.',
  river: '–°–∞–º–∞—è –¥–ª–∏–Ω–Ω–∞—è —Ä–µ–∫–∞ ‚Äî –ù–∏–ª –∏–ª–∏ –ê–º–∞–∑–æ–Ω–∫–∞ (—Å–ø–æ—Ä—ã –µ—â—ë –∏–¥—É—Ç!).',
  lake: '–°–∞–º–æ–µ –≥–ª—É–±–æ–∫–æ–µ –æ–∑–µ—Ä–æ ‚Äî –ë–∞–π–∫–∞–ª (–±–æ–ª–µ–µ 1,6 –∫–º).',
  plant: '–†–∞—Å—Ç–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥—è—Ç –∫–∏—Å–ª–æ—Ä–æ–¥ –∏ —è–≤–ª—è—é—Ç—Å—è –æ—Å–Ω–æ–≤–æ–π –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–∞ —ç–∫–æ—Å–∏—Å—Ç–µ–º.',
  tree: '–°–∞–º—ã–µ –¥—Ä–µ–≤–Ω–∏–µ –¥–µ—Ä–µ–≤—å—è –∂–∏–≤—É—Ç –±–æ–ª–µ–µ 4 000 –ª–µ—Ç.',
  coal: '–£–≥–æ–ª—å –æ–±—Ä–∞–∑–æ–≤–∞–ª—Å—è –∏–∑ –¥—Ä–µ–≤–Ω–∏—Ö –ª–µ—Å–æ–≤, –ø–æ–≥—Ä–µ–±—ë–Ω–Ω—ã—Ö –º–∏–ª–ª–∏–æ–Ω—ã –ª–µ—Ç –Ω–∞–∑–∞–¥.',
  oil: '–ù–µ—Ñ—Ç—å ‚Äî —Å–º–µ—Å—å —É–≥–ª–µ–≤–æ–¥–æ—Ä–æ–¥–æ–≤; –∏–∑ –Ω–µ—ë –¥–µ–ª–∞—é—Ç —Ç–æ–ø–ª–∏–≤–æ, –ø–ª–∞—Å—Ç–∏–∫ –∏ —Ç—ã—Å—è—á–∏ –≤–µ—â–µ–π.',
  pressure: '–î–∞–≤–ª–µ–Ω–∏–µ ‚Äî —Å–∏–ª–∞ –Ω–∞ –ø–ª–æ—â–∞–¥—å; –≤ –æ–∫–µ–∞–Ω–µ –æ–Ω–æ —Ä–∞—Å—Ç—ë—Ç –Ω–∞ 1 –∞—Ç–º –∫–∞–∂–¥—ã–µ ~10 –º.',
  time: '–í –æ–±—â–µ–π —Ç–µ–æ—Ä–∏–∏ –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –≤—Ä–µ–º—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–∫–æ—Ä–æ—Å—Ç–∏ –∏ –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏–∏.',
  life: '–í—Å–µ –∏–∑–≤–µ—Å—Ç–Ω—ã–µ —Ñ–æ—Ä–º—ã –∂–∏–∑–Ω–∏ –Ω–∞ –ó–µ–º–ª–µ –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ —É–≥–ª–µ—Ä–æ–¥–µ.',
  bacteria: '–ë–∞–∫—Ç–µ—Ä–∏–π –Ω–∞ –ó–µ–º–ª–µ –±–æ–ª—å—à–µ, —á–µ–º –∑–≤—ë–∑–¥ –≤ –Ω–∞–±–ª—é–¥–∞–µ–º–æ–π –í—Å–µ–ª–µ–Ω–Ω–æ–π.',
  fish: '–°–∞–º–∞—è –¥—Ä–µ–≤–Ω—è—è —á–µ–ª—é—Å—Ç–Ω–∞—è —Ä—ã–±–∞ –∂–∏–ª–∞ –±–æ–ª–µ–µ 400 –º–ª–Ω –ª–µ—Ç –Ω–∞–∑–∞–¥.',
  animal: '–ñ–∏–≤–æ—Ç–Ω—ã–µ –ø–æ—è–≤–∏–ª–∏—Å—å —Å–æ—Ç–Ω–∏ –º–∏–ª–ª–∏–æ–Ω–æ–≤ –ª–µ—Ç –Ω–∞–∑–∞–¥ ‚Äî –∑–∞–¥–æ–ª–≥–æ –¥–æ –¥–∏–Ω–æ–∑–∞–≤—Ä–æ–≤.',
  bird: '–ü—Ç–∏—Ü—ã ‚Äî –ø—Ä—è–º—ã–µ –ø–æ—Ç–æ–º–∫–∏ –ø–µ—Ä–Ω–∞—Ç—ã—Ö –¥–∏–Ω–æ–∑–∞–≤—Ä–æ–≤.',
  human: '–ì–µ–Ω—ã —á–µ–ª–æ–≤–µ–∫–∞ –Ω–∞ ~60% —Å–æ–≤–ø–∞–¥–∞—é—Ç —Å –≥–µ–Ω–∞–º–∏ –±–∞–Ω–∞–Ω–∞ ‚Äî —ç–≤–æ–ª—é—Ü–∏—è –ª—é–±–∏—Ç –ø–æ–≤—Ç–æ—Ä–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ä–µ—à–µ–Ω–∏—è.',
  tool: '–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∏ –Ω–µ —Ç–æ–ª—å–∫–æ –ª—é–¥–∏ ‚Äî –≤–æ—Ä–æ–Ω—ã –∏ —à–∏–º–ø–∞–Ω–∑–µ —Ç–æ–∂–µ –º–∞—Å—Ç–µ—Ä–∞.',
  wheel: '–ö–æ–ª–µ—Å–æ –≤ —Å–æ—á–µ—Ç–∞–Ω–∏–∏ —Å –æ—Å—å—é ‚Äî –æ–¥–Ω–æ –∏–∑ –≤–µ–ª–∏—á–∞–π—à–∏—Ö –∏–∑–æ–±—Ä–µ—Ç–µ–Ω–∏–π –≤ –∏—Å—Ç–æ—Ä–∏–∏.',
  cart: '–¢–µ–ª–µ–≥–∞ —Ä–µ–∑–∫–æ —É–≤–µ–ª–∏—á–∏–ª–∞ –≥—Ä—É–∑–æ–ø–æ–¥—ä—ë–º–Ω–æ—Å—Ç—å –∏ –¥–∞–ª—å–Ω–æ—Å—Ç—å –ø–µ—Ä–µ–≤–æ–∑–æ–∫.',
  sandstorm: '–ü–µ—Å—á–∞–Ω—ã–µ –±—É—Ä–∏ –º–æ–≥—É—Ç –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç—å –ø—ã–ª—å —á–µ—Ä–µ–∑ –æ–∫–µ–∞–Ω—ã.',
  storm: '–ù–∞ –Æ–ø–∏—Ç–µ—Ä–µ –±—É—à—É–µ—Ç —à—Ç–æ—Ä–º (–ë–æ–ª—å—à–æ–µ –ö—Ä–∞—Å–Ω–æ–µ –ü—è—Ç–Ω–æ) —É–∂–µ —Å–æ—Ç–Ω–∏ –ª–µ—Ç.',
  cloud: '–û–±–ª–∞–∫–∞ —Å–æ—Å—Ç–æ—è—Ç –∏–∑ –º–∏–∫—Ä–æ—Å–∫–æ–ø–∏—á–µ—Å–∫–∏—Ö –∫–∞–ø–µ–ª—å –≤–æ–¥—ã –∏–ª–∏ –∫—Ä–∏—Å—Ç–∞–ª–ª–∏–∫–æ–≤ –ª—å–¥–∞.',
  sky: '–ù–µ–±–æ –≥–æ–ª—É–±–æ–µ –∏–∑-–∑–∞ —Ä–∞—Å—Å–µ—è–Ω–∏—è –∫–æ—Ä–æ—Ç–∫–∏—Ö –≤–æ–ª–Ω —Å–≤–µ—Ç–∞ (—ç—Ñ—Ñ–µ–∫—Ç –†—ç–ª–µ—è).',
  sun: '–°–æ–ª–Ω—Ü–µ ‚Äî –∑–≤–µ–∑–¥–∞ –∫–ª–∞—Å—Å–∞ G2V, –µ–º—É ~4,6 –º–ª—Ä–¥ –ª–µ—Ç.',
  moon: '–õ—É–Ω–∞ —É–¥–∞–ª—è–µ—Ç—Å—è –æ—Ç –ó–µ–º–ª–∏ –ø—Ä–∏–º–µ—Ä–Ω–æ –Ω–∞ 3,8 —Å–º –≤ –≥–æ–¥.',
  brick: '–ö–∏—Ä–ø–∏—á–∏ –¥–µ–ª–∞–ª–∏ –µ—â—ë –¥—Ä–µ–≤–Ω–∏–µ —à—É–º–µ—Ä—ã –±–æ–ª–µ–µ 5 000 –ª–µ—Ç –Ω–∞–∑–∞–¥.',
  house: '–ü–µ—Ä–≤—ã–µ –¥–æ–º–∞ —Å—Ç—Ä–æ–∏–ª–∏ –∏–∑ –≥–ª–∏–Ω—ã, –¥–µ—Ä–µ–≤–∞ –∏ –∫–æ—Å—Ç–µ–π –º–∞–º–æ–Ω—Ç–æ–≤.',
  city: '–ì–æ—Ä–æ–¥–∞ –≤–æ–∑–Ω–∏–∫–∞–ª–∏ —É –≤–æ–¥—ã ‚Äî —Ä–µ–∫–∏ –±—ã–ª–∏ –¥–æ—Ä–æ–≥–∞–º–∏ –∏ –∏—Å—Ç–æ—á–Ω–∏–∫–æ–º –∂–∏–∑–Ω–∏.',
  computer: '–ü–µ—Ä–≤—ã–µ –∫–æ–º–ø—å—é—Ç–µ—Ä—ã –∑–∞–Ω–∏–º–∞–ª–∏ –∫–æ–º–Ω–∞—Ç—ã; —Ç–µ–ø–µ—Ä—å –æ–Ω–∏ –≤ –∫–∞—Ä–º–∞–Ω–µ.',
  electricity_gen: '–ü–µ—Ä–≤—ã–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã ‚Äî –¥–∏–Ω–∞–º–æ-–º–∞—à–∏–Ω—ã XIX –≤–µ–∫–∞.',
  sandglass: '–ü–µ—Å–æ—á–Ω—ã–µ —á–∞—Å—ã —Ç–æ—á–Ω—ã, –µ—Å–ª–∏ –ø–µ—Å—á–∏–Ω–∫–∏ –æ–¥–∏–Ω–∞–∫–æ–≤—ã –∏ —Å—É—Ö–∏–µ.',
  glass_sandwich: '–°—Ç–µ–∫–ª–æ–ø–∞–∫–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Ç–µ–ø–ª–æ, —Å–Ω–∏–∂–∞—è –ø–æ—Ç–µ—Ä–∏ —ç–Ω–µ—Ä–≥–∏–∏.',
  ash: '–ü–µ–ø–µ–ª –≤—É–ª–∫–∞–Ω–æ–≤ –¥–µ–ª–∞–µ—Ç –ø–æ—á–≤—É –ø–ª–æ–¥–æ—Ä–æ–¥–Ω–æ–π.',
  smoke: '–î—ã–º ‚Äî —Å–º–µ—Å—å –≥–∞–∑–æ–≤ –∏ —Ç–≤—ë—Ä–¥—ã—Ö —á–∞—Å—Ç–∏—Ü; –æ–Ω —Ä–∞—Å—Å–µ–∏–≤–∞–µ—Ç —Å–≤–µ—Ç.',
  alcohol: '–î—Ä–æ–∂–∂–∏ –ø—Ä–µ–≤—Ä–∞—â–∞—é—Ç —Å–∞—Ö–∞—Ä –≤ —Å–ø–∏—Ä—Ç ‚Äî —ç—Ç–æ –∏ –µ—Å—Ç—å —Ñ–µ—Ä–º–µ–Ω—Ç–∞—Ü–∏—è.',
  bread: '–î—Ä–æ–∂–∂–∏ –≤—ã–¥–µ–ª—è—é—Ç CO‚ÇÇ ‚Äî —Ç–µ—Å—Ç–æ –ø–æ–¥–Ω–∏–º–∞–µ—Ç—Å—è –∏ –ø–æ–ª—É—á–∞–µ—Ç—Å—è —Ö–ª–µ–±.',
  dough: '–ö–ª–µ–π–∫–æ–≤–∏–Ω–∞ –≤ –º—É–∫–µ —É–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ø—É–∑—ã—Ä—å–∫–∏ –≥–∞–∑–∞ ‚Äî —Ç–µ—Å—Ç–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è —É–ø—Ä—É–≥–∏–º.',
  flour: '–ü–æ–º–æ–ª –∑–µ—Ä–Ω–∞ –¥–µ–ª–∞–ª —Ü–∏–≤–∏–ª–∏–∑–∞—Ü–∏–∏ —Å—ã—Ç—ã–º–∏ –∏ –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–º–∏.',
  energy_drink: '–ö–æ—Ñ–µ–∏–Ω ‚Äî –º—è–≥–∫–∏–π —Å—Ç–∏–º—É–ª—è—Ç–æ—Ä; –≤–∞–∂–Ω–æ –∑–Ω–∞—Ç—å –º–µ—Ä—É.',
  robot: '–°–ª–æ–≤–æ ¬´—Ä–æ–±–æ—Ç¬ª –ø—Ä–∏–¥—É–º–∞–ª –ø–∏—Å–∞—Ç–µ–ª—å –ö–∞—Ä–µ–ª –ß–∞–ø–µ–∫ –≤ 1920-—Ö.'
};

/* ---------- State ---------- */
const state={
  discovered:new Set(['air','earth','fire','water']),
  bowlA:null,bowlB:null,stars:0,user:'–ì–æ—Å—Ç—å',
  lastFreeHint:0,
  quests:{ mix10:false, open5:false, visitDaily:false },
  stats:{ mixes:0, opens:0, lastVisit:0 }
};

/* ---------- Identity ---------- */
(function initIdentity(){
  const u=tg?.initDataUnsafe?.user;
  state.user = u?.username || u?.first_name || '–ì–æ—Å—Ç—å';
  document.getElementById('tgUser').innerHTML = `–ò–≥—Ä–æ–∫: ${state.user} ¬∑ <span class="version">v1.8.0</span>`;
})();

/* ---------- DOM ---------- */
const cardsEl=document.getElementById('cards');
const bowlA=document.getElementById('bowlA');
const bowlB=document.getElementById('bowlB');
const discCount=document.getElementById('discCount');
const totalCount=document.getElementById('totalCount');
const starsEl=document.getElementById('stars');
const searchEl=document.getElementById('search');
const toastEl=document.getElementById('toast');
const emptyState=document.getElementById('emptyState');
const modal=document.getElementById('modal');
const sheet=document.getElementById('sheet');
const factModal=document.getElementById('factModal');
const factEmoji=document.getElementById('factEmoji');
const factName=document.getElementById('factName');
const factText=document.getElementById('factText');
const factOk=document.getElementById('factOk');

/* ---------- Helpers ---------- */
const elemById = id => ELEMENTS.find(e=>e.id===id);
function chipHTML(id){ const e=elemById(id); return e?`<span class="chip"><span style="font-size:18px">${e.emoji}</span><b>${e.name}</b></span>`:''; }
function k(a,b){ return a<b?`${a}|${b}`:`${b}|${a}` }
function toast(m){ toastEl.textContent=m; toastEl.classList.add('show'); setTimeout(()=>toastEl.classList.remove('show'),1400); tg?.HapticFeedback?.notificationOccurred('success'); }
function openModal(inner){ sheet.innerHTML=inner; modal.classList.add('show'); modal.onclick=(e)=>{ if(e.target===modal) modal.classList.remove('show'); } }
function fmtTimeLeft(ms){ const s=Math.max(0,Math.ceil(ms/1000)); const h=Math.floor(s/3600), m=Math.floor((s%3600)/60); const ss=s%60; return `${h}—á ${m}–º ${ss}—Å`; }

/* ---------- Theme toggle (persist) ---------- */
const THEME_KEY='elementix_theme';
function applySavedTheme(){
  const saved = localStorage.getItem(THEME_KEY);
  const prefersLight = window.matchMedia && window.matchMedia('(prefers-color-scheme: light)').matches;
  const mode = saved || (prefersLight ? 'light' : 'dark');
  document.documentElement.setAttribute('data-theme', mode);
  updateThemeButton(mode);
}
function toggleTheme(){
  const cur=document.documentElement.getAttribute('data-theme')||'dark';
  const next = cur==='dark'?'light':'dark';
  document.documentElement.setAttribute('data-theme', next);
  localStorage.setItem(THEME_KEY, next);
  updateThemeButton(next);
}
function updateThemeButton(mode){
  const btn=document.getElementById('btnTheme');
  btn.textContent = mode==='dark' ? 'üåô' : '‚òÄÔ∏è';
  btn.title = mode==='dark' ? '–¢—ë–º–Ω–∞—è —Ç–µ–º–∞' : '–°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞';
}

/* ---------- Render ---------- */
function render(){
  totalCount.textContent = ELEMENTS.length;
  const q=(searchEl.value||'').toLowerCase();

  const items=ELEMENTS
    .filter(e=>state.discovered.has(e.id) && (!q || e.name.toLowerCase().includes(q)));

  // –ø–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ —Å–æ —Å—Ç—É–ø–µ–Ω—á–∞—Ç–æ–π –∑–∞–¥–µ—Ä–∂–∫–æ–π
  cardsEl.innerHTML = items.map((e,idx)=>`
    <div class="card" data-id="${e.id}" data-rar="${e.rar}" style="--delay:${(idx*0.04).toFixed(2)}s">
      <span class="emoji">${e.emoji}</span>
      <span class="name">${e.name}</span>
      <span class="rar">${e.rar}</span>
    </div>
  `).join('');

  document.querySelectorAll('.card').forEach(c=>c.addEventListener('click',()=> pickToBowl(c.dataset.id)));
  bowlA.innerHTML = state.bowlA ? chipHTML(state.bowlA) : '<span class="sub">–í—ã–±–µ—Ä–∏ —ç–ª–µ–º–µ–Ω—Ç‚Ä¶</span>';
  bowlB.innerHTML = state.bowlB ? chipHTML(state.bowlB) : '<span class="sub">‚Ä¶–∏ –≤—Ç–æ—Ä–æ–π</span>';
  discCount.textContent = state.discovered.size;
  starsEl.textContent = state.stars;
  emptyState.style.display = items.length? 'none':'block';
}

/* ---------- Actions ---------- */
function pickToBowl(id){ if (!state.bowlA) state.bowlA=id; else state.bowlB=id; render(); tg?.HapticFeedback?.impactOccurred('light'); }
function selectNone(){ state.bowlA=state.bowlB=null; render(); }
function doMix(){
  const a=state.bowlA,b=state.bowlB; if(!a||!b){ toast('–ù—É–∂–Ω–æ 2 —ç–ª–µ–º–µ–Ω—Ç–∞'); return; }
  state.stats.mixes++;
  const result=RECIPES.get(k(a,b));
  selectNone();
  if(!result){ toast('–ù–µ –≤—ã—à–ª–æ'); saveProgressDebounced(); checkQuests(); return; }
  const wasNew=!state.discovered.has(result);
  state.discovered.add(result);
  if (wasNew){
    state.stars+=2; state.stats.opens++;
    toast('–ù–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç! +2 ‚≠ê');
    // –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–∞–∫—Ç
    showFact(result);
  }
  render();
  saveProgressDebounced(); checkQuests();
}

/* ---------- Hints ---------- */
const FREE_HINT_COOLDOWN = 8*60*60*1000; // 8h
const HINT_PRICE = 5; // stars

function showHintModal(){
  const now = Date.now();
  const next = state.lastFreeHint + FREE_HINT_COOLDOWN;
  const canFree = now >= next;
  const left = next - now;
  const inner = `
    <div class="hint-head"><div class="hint-bulb">üí°</div><h3 style="margin:0">–ü–æ–¥—Å–∫–∞–∑–∫–∏</h3></div>
    <div class="opt">
      <div><b>–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è</b><br><small>${canFree ? '–î–æ—Å—Ç—É–ø–Ω–∞ —Å–µ–π—á–∞—Å' : '–ß–µ—Ä–µ–∑ ' + fmtTimeLeft(left)}</small></div>
      <button class="btn success" id="freeHintBtn" ${canFree?'':'disabled'}>–ü–æ–ª—É—á–∏—Ç—å</button>
    </div>
    <div class="opt">
      <div><b>–ü–ª–∞—Ç–Ω–∞—è</b><br><small>–°—Ç–æ–∏—Ç ${HINT_PRICE}‚≠ê ‚Ä¢ –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤–æ–∑–º–æ–∂–Ω—ã–π —Ä–µ—Ü–µ–ø—Ç</small></div>
      <button class="btn" id="paidHintBtn">–ö—É–ø–∏—Ç—å</button>
    </div>
    <div class="hint-card" id="hintArea" style="display:none">
      <div class="hint-row" id="hintRow"></div>
      <div class="center"><button class="btn success" id="okHint">–û–∫–µ–π</button></div>
    </div>
  `;
  openModal(inner);
  document.getElementById('freeHintBtn')?.addEventListener('click', ()=> useHint(true));
  document.getElementById('paidHintBtn')?.addEventListener('click', ()=> useHint(false));
}

function useHint(isFree){
  if (isFree){
    const now=Date.now();
    if (now < state.lastFreeHint + FREE_HINT_COOLDOWN) return;
    state.lastFreeHint = now;
  } else {
    if (state.stars < HINT_PRICE){ toast('–ú–∞–ª–æ ‚≠ê'); showShop(); return; }
    state.stars -= HINT_PRICE;
  }
  const hint = getHint();
  if (!hint){ toast('–ü–æ—Ö–æ–∂–µ, –≤—Å—ë –æ—Ç–∫—Ä—ã—Ç–æ!'); document.getElementById('modal').classList.remove('show'); render(); saveProgressDebounced(); return; }
  const [a,b,res] = hint;
  const row = document.getElementById('hintRow');
  row.innerHTML = `${chipHTML(a)} <span class="eq">+</span> ${chipHTML(b)} <span class="eq">‚Üí</span> ${chipHTML(res)}`;
  document.getElementById('hintArea').style.display='block';
  document.getElementById('okHint').onclick = ()=>{ document.getElementById('modal').classList.remove('show'); render(); saveProgressDebounced(); };
  render(); saveProgressDebounced();
}

function getHint(){
  for (const [key,res] of RECIPES){
    const [a,b] = key.split('|');
    if (!state.discovered.has(res) && state.discovered.has(a) && state.discovered.has(b)){
      return [a,b,res];
    }
  }
  return null;
}

/* ---------- Shop ---------- */
function showShop(){
  const inner = `
    <h3>–ú–∞–≥–∞–∑–∏–Ω ‚≠ê</h3>
    <div class="opt"><div><b>10 ‚≠ê</b><br><small>–ú–∞–ª—ã–π –Ω–∞–±–æ—Ä</small></div><button class="btn" data-pack="10">–ü–æ–ª—É—á–∏—Ç—å</button></div>
    <div class="opt"><div><b>30 ‚≠ê</b><br><small>–°—Ä–µ–¥–Ω–∏–π –Ω–∞–±–æ—Ä</small></div><button class="btn" data-pack="30">–ü–æ–ª—É—á–∏—Ç—å</button></div>
    <div class="opt"><div><b>80 ‚≠ê</b><br><small>–ë–æ–ª—å—à–æ–π –Ω–∞–±–æ—Ä</small></div><button class="btn" data-pack="80">–ü–æ–ª—É—á–∏—Ç—å</button></div>
    <div class="opt"><div><b>–°–º–æ—Ç—Ä–µ—Ç—å —Ä–æ–ª–∏–∫</b><br><small>+3 ‚≠ê –∑–∞ –ø—Ä–æ—Å–º–æ—Ç—Ä (—ç–º—É–ª—è—Ü–∏—è)</small></div><button class="btn warn" id="watch">‚ñ∂Ô∏è</button></div>
    <div class="opt"><div class="badge">–í–∞—à –±–∞–ª–∞–Ω—Å: ‚≠ê <b id="balance">${state.stars}</b></div><button class="btn ghost" id="closeShop">–ó–∞–∫—Ä—ã—Ç—å</button></div>
  `;
  openModal(inner);
  sheet.querySelectorAll('button[data-pack]').forEach(btn=> btn.onclick = ()=>{
    const n=parseInt(btn.dataset.pack,10); state.stars+=n; render(); saveProgressDebounced(); showShop();
  });
  document.getElementById('watch').onclick = ()=>{ state.stars+=3; toast('+3 ‚≠ê'); render(); saveProgressDebounced(); showShop(); };
  document.getElementById('closeShop').onclick = ()=> document.getElementById('modal').classList.remove('show');
}

/* ---------- Quests & Achievements ---------- */
function showQuests(){
  const doneMix10 = state.stats.mixes>=10;
  const doneOpen5 = state.stats.opens>=5;
  const today = new Date(); today.setHours(0,0,0,0);
  const visitedToday = state.stats.lastVisit >= today.getTime();

  const inner = `
    <h3>–ó–∞–¥–∞–Ω–∏—è</h3>
    <div class="opt">
      <div><b>–°–¥–µ–ª–∞–π 10 —Å–º–µ—à–∏–≤–∞–Ω–∏–π</b><br><small>${state.stats.mixes}/10</small></div>
      <button class="btn ${state.quests.mix10?'ghost':'success'}" id="q1">${doneMix10&&!state.quests.mix10?'–ó–∞–±—Ä–∞—Ç—å 5‚≠ê': (state.quests.mix10?'–í—ã–ø–æ–ª–Ω–µ–Ω–æ':'–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ')}</button>
    </div>
    <div class="opt">
      <div><b>–û—Ç–∫—Ä–æ–π 5 –Ω–æ–≤—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤</b><br><small>${state.stats.opens}/5</small></div>
      <button class="btn ${state.quests.open5?'ghost':'success'}" id="q2">${doneOpen5&&!state.quests.open5?'–ó–∞–±—Ä–∞—Ç—å 8‚≠ê': (state.quests.open5?'–í—ã–ø–æ–ª–Ω–µ–Ω–æ':'–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ')}</button>
    </div>
    <div class="opt">
      <div><b>–ó–∞–π–¥–∏ —Å–µ–≥–æ–¥–Ω—è</b><br><small>${visitedToday?'–°–µ–≥–æ–¥–Ω—è':'–ù–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–æ'}</small></div>
      <button class="btn ${state.quests.visitDaily?'ghost':'success'}" id="q3">${visitedToday&&!state.quests.visitDaily?'–ó–∞–±—Ä–∞—Ç—å 3‚≠ê': (state.quests.visitDaily?'–í—ã–ø–æ–ª–Ω–µ–Ω–æ':'–ù–µ–¥–æ—Å—Ç—É–ø–Ω–æ')}</button>
    </div>
    <div class="opt"><div class="badge">–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Å—á–∏—Ç–∞—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ ‚Ä¢ –æ–±–Ω–æ–≤—è—Ç—Å—è –ø—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ</div><button class="btn ghost" id="closeQuests">–ó–∞–∫—Ä—ã—Ç—å</button></div>
  `;
  openModal(inner);
  document.getElementById('q1').onclick = ()=>{ if(doneMix10 && !state.quests.mix10){ state.quests.mix10=true; state.stars+=5; render(); saveProgressDebounced(); showQuests(); } };
  document.getElementById('q2').onclick = ()=>{ if(doneOpen5 && !state.quests.open5){ state.quests.open5=true; state.stars+=8; render(); saveProgressDebounced(); showQuests(); } };
  document.getElementById('q3').onclick = ()=>{ if(visitedToday && !state.quests.visitDaily){ state.quests.visitDaily=true; state.stars+=3; render(); saveProgressDebounced(); showQuests(); } };
  document.getElementById('closeQuests').onclick = ()=> document.getElementById('modal').classList.remove('show');
}

function checkQuests(){
  const today = new Date(); today.setHours(0,0,0,0);
  if (Date.now() > today.getTime() && state.stats.lastVisit < today.getTime()){
    state.stats.lastVisit = Date.now();
  }
}

/* ---------- Persistence ---------- */
const LS_KEY='elementix_v180_progress';
function loadLocal(){
  try{ const j=JSON.parse(localStorage.getItem(LS_KEY)); if(j){
    state.discovered=new Set(j.discovered||['air','earth','fire','water']);
    state.stars=j.stars||0; state.lastFreeHint=j.lastFreeHint||0;
    state.quests=j.quests||state.quests; state.stats=j.stats||state.stats;
  }}catch{}
}
function saveLocal(){
  try{ localStorage.setItem(LS_KEY, JSON.stringify({
    discovered:[...state.discovered], stars:state.stars, lastFreeHint:state.lastFreeHint,
    quests:state.quests, stats:state.stats
  })); }catch{}
}

async function tryServerLoad(){
  if (!tg?.initData) return null;
  try{
    const r=await fetch('/api/load',{headers:{'X-Telegram-Init-Data':tg.initData}});
    if(!r.ok) return null;
    const json=await r.json();
    if(json?.ok && json.data){
      const d=json.data;
      if (Array.isArray(d.discovered)) state.discovered=new Set(d.discovered);
      if (typeof d.stars==='number') state.stars=d.stars;
      if (typeof d.lastFreeHint==='number') state.lastFreeHint=d.lastFreeHint;
      if (d.quests) state.quests=d.quests;
      if (d.stats) state.stats=d.stats;
      return true;
    }
  }catch(e){}
  return null;
}
async function tryServerSave(){
  if (!tg?.initData) return null;
  try{
    const r=await fetch('/api/save',{
      method:'POST',
      headers:{'Content-Type':'application/json','X-Telegram-Init-Data':tg.initData},
      body:JSON.stringify({discovered:[...state.discovered],stars:state.stars,lastFreeHint:state.lastFreeHint,quests:state.quests,stats:state.stats})
    });
    return r.ok;
  }catch(e){ return null; }
}
const saveProgressDebounced = debounce(()=>{ saveLocal(); tryServerSave(); }, 250);
function debounce(fn,ms){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a),ms); } }

/* ---------- FACT MODAL logic ---------- */
function showFact(id){
  const e = elemById(id);
  if (!e) return;
  factEmoji.textContent = e.emoji || '‚ú®';
  factName.textContent = '–û—Ç–∫—Ä—ã—Ç —ç–ª–µ–º–µ–Ω—Ç: ' + (e.name || '‚Äî');
  factText.textContent = FACTS[id] || '–ò–Ω—Ç–µ—Ä–µ—Å–Ω—ã–π —Ñ–∞–∫—Ç —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –∑–¥–µ—Å—å!';
  // –æ—Ç–∫—Ä—ã–≤–∞–µ–º –º–æ–¥–∞–ª–∫—É –∏ –±–ª–æ–∫–∏—Ä—É–µ–º –∑–∞–∫—Ä—ã—Ç–∏–µ –∫–ª–∏–∫–æ–º –ø–æ —Ñ–æ–Ω—É (—Ç–æ–ª—å–∫–æ –≤—Ä—É—á–Ω—É—é)
  factModal.classList.add('show');
  // –∫–ª–∏–∫–∏ –ø–æ —Ñ–æ–Ω—É –∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º
  factModal.addEventListener('click', (ev)=>{
    if (ev.target === factModal){
      // –Ω–∏—á–µ–≥–æ –Ω–µ –¥–µ–ª–∞–µ–º ‚Äî –∑–∞–∫—Ä—ã—Ç–∏–µ —Ç–æ–ª—å–∫–æ –ø–æ –∫–Ω–æ–ø–∫–µ
      tg?.HapticFeedback?.impactOccurred('light');
    }
  }, { once:true });
}
factOk.addEventListener('click', ()=>{
  factModal.classList.remove('show');
  tg?.HapticFeedback?.notificationOccurred('success');
});

/* ---------- Events ---------- */
document.getElementById('btnMixDock').onclick=doMix;
document.getElementById('btnClearDock').onclick=selectNone;
document.getElementById('fabHint').onclick=showHintModal;

document.getElementById('btnReset').onclick=()=>{
  if(confirm('–°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å?')){
    state.discovered=new Set(['air','earth','fire','water']); state.stars=0; state.stats.mixes=0; state.stats.opens=0;
    toast('–°–±—Ä–æ—à–µ–Ω–æ'); selectNone(); render(); saveProgressDebounced();
  }
};
document.getElementById('btnShare').onclick=()=>{
  const url=(location.origin+location.pathname).replace(/#.*$/,'');
  const text=encodeURIComponent('–û—Ç–∫—Ä—ã–ª –Ω–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç –≤ Elementix!');
  const share=`https://t.me/share/url?url=${encodeURIComponent(url)}&text=${text}`;
  if (tg) tg.openTelegramLink(share); else window.open(share,'_blank');
};
document.getElementById('btnShop').onclick=showShop;
document.getElementById('btnQuests').onclick=showQuests;
document.getElementById('search').oninput=render;
document.getElementById('btnTheme').onclick=toggleTheme;

/* ---------- Init ---------- */
(async function init(){
  applySavedTheme();
  loadLocal();
  await tryServerLoad();
  render();
  state.stats.lastVisit = Date.now();
  saveProgressDebounced();
})();
</script>
</body>
</html>
