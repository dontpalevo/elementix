<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, viewport-fit=cover">
<title>Elementix ‚Äî –∞–ª—Ö–∏–º–∏—è</title>
<meta name="color-scheme" content="dark">
<meta name="theme-color" content="#0b0f14">
<style>
:root{--bg:#0b0f14;--panel:#10161d;--panel2:#0b1218;--line:#1f2a39;--ink:#e7ecf4;--muted:#9fb0bf;--accent:#6fb1ff;--gold:#ffd166}
*{box-sizing:border-box}
html,body{height:100%;margin:0;color:var(--ink);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,"Noto Sans",sans-serif;overscroll-behavior-y:none}
body{background:radial-gradient(800px 480px at 80% -10%, #172332, #0b0f14)}
.app{min-height:100%;display:flex;flex-direction:column}
.header{position:sticky;top:0;z-index:70;display:flex;align-items:center;gap:10px;height:48px;padding:0 12px;padding-top:calc(env(safe-area-inset-top,0px));border-bottom:1px solid var(--line);background:rgba(11,15,20,.88);backdrop-filter:blur(8px)}
.title{font-weight:800}
.spacer{flex:1}
.stars{display:flex;align-items:center;gap:6px;background:#121b28;border:1px solid #253247;color:var(--gold);border-radius:999px;padding:6px 10px;font-weight:800}
.main{display:flex;flex-direction:column;gap:10px;padding:8px 12px calc(120px + env(safe-area-inset-bottom,0px))}
/* Prettier STICKY chips */
.crumbs{position:sticky;top:48px;z-index:65;display:flex;gap:10px;align-items:center;overflow-x:auto;padding:8px 6px;background:rgba(11,15,20,.85);backdrop-filter:blur(6px);border:1px solid var(--line);border-radius:12px}
.crumbs::-webkit-scrollbar{display:none}
.token{position:relative;display:grid;place-items:center;width:42px;height:42px;border-radius:50%;background:linear-gradient(180deg,#0f1620,#0b1218);border:1px solid #203043;box-shadow:0 6px 18px rgba(0,0,0,.25);cursor:pointer;user-select:none;transition:transform .08s ease, box-shadow .2s ease}
.token .emo{font-size:22px}
.token:active{transform:translateY(1px)}
.token.glow{box-shadow:0 0 0 2px rgba(111,177,255,.35), 0 10px 22px rgba(111,177,255,.18)}
.token::after{content:attr(data-tip);position:absolute;bottom:-18px;font-size:10px;color:#8fa8bf}
.bowls{display:grid;grid-template-columns:1fr;gap:10px}
.drop{position:relative;background:var(--panel2);border:1px dashed #2a384b;border-radius:16px;min-height:160px;display:grid;place-items:center;overflow:hidden}
.drop .hint{position:absolute;top:8px;left:12px;color:var(--muted);font-size:12px}
.drop .clear{position:absolute;top:8px;right:8px;background:#121b28;border:1px solid #253247;color:#cfe1ff;border-radius:9px;padding:5px 9px;font-size:11px;cursor:pointer}
.selection{display:flex;gap:10px;align-items:center}
.selection .emoji{font-size:34px} .selection .name{font-size:13px}
.tools{position:sticky;top:calc(48px + 56px); z-index:60;background:rgba(11,15,20,.85);backdrop-filter:blur(8px);border:1px solid var(--line);border-radius:12px;padding:8px;display:flex;gap:8px;align-items:center}
.tools input{flex:1;background:#0b1218;border:1px solid var(--line);border-radius:10px;color:#cfe1ff;padding:10px}
.tools .count{font-size:12px;color:#9fb0bf}
.grid{display:grid;grid-template-columns:repeat(auto-fill, minmax(104px,1fr));gap:10px}
.card{background:linear-gradient(180deg,#101821,#0b1218);border:1px solid #1f2a39;border-radius:14px;padding:10px;display:grid;gap:6px;cursor:grab;user-select:none;position:relative;transition:transform .1s ease, box-shadow .2s ease}
.card:hover{transform:translateY(-2px);box-shadow:0 10px 18px rgba(0,0,0,.26)}
.card.locked{opacity:.45;filter:grayscale(.35);cursor:not-allowed}
.emoji{font-size:30px} .name{font-size:12px;color:#cfe1ff}
.tag{position:absolute;top:8px;right:8px;font-size:10px;background:#121b28;border:1px solid #253247;border-radius:999px;padding:2px 6px}
.tag.common{color:#a5b4c2}.tag.rare{color:#7aa2ff}.tag.epic{color:#e19cff}
.dock{position:fixed;left:0;right:0;bottom:0;z-index:80;background:linear-gradient(180deg, rgba(11,15,20,0), rgba(11,15,20,.95));padding:10px 12px calc(12px + env(safe-area-inset-bottom,0px));display:flex;justify-content:center}
.dock .inner{display:grid;grid-template-columns:1fr auto 1fr;gap:10px;align-items:center;max-width:900px;width:100%}
.btn{background:#1b2633;border:1px solid #253247;color:#cfe1ff;border-radius:16px;padding:14px 14px;font-weight:700;cursor:pointer;transition:transform .05s ease}
.btn:active{transform:translateY(1px)}
.btn.primary{background:#6fb1ff;border:none;color:#07101c;font-weight:900;padding:16px 24px;border-radius:20px;font-size:16px}
/* Stacked hint button */
#hint{display:flex;flex-direction:column;align-items:center;gap:2px;min-width:132px;padding:12px 14px}
.hline1{font-weight:900}
.hline2{font-size:12px;opacity:.9}
.toast{position:fixed;left:50%;bottom:96px;transform:translateX(-50%);background:#0b1218;border:1px solid #1f2a39;color:#cfe1ff;padding:10px 14px;border-radius:12px;opacity:0;animation:pop .9s ease-out forwards;z-index:90}
@keyframes pop{0%{opacity:0;transform:translateX(-50%) translateY(8px)}20%{opacity:1}100%{opacity:1;transform:translateX(-50%) translateY(0)}}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.55);z-index:95}
.modal .sheet{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:min(420px,92vw);background:#0b1218;border:1px solid #1f2a39;border-radius:16px;padding:16px}
.modal .title{font-weight:800;margin:0 0 10px 0}
.modal .row{display:flex;align-items:center;justify-content:space-between;background:#0f1620;border:1px solid #243042;border-radius:12px;padding:10px 12px;margin:6px 0}
.modal .row .lab{color:#9fb0bf;font-size:12px}
.modal .row .val{font-weight:900}
.modal .btns{display:flex;gap:10px;justify-content:flex-end;margin-top:10px}
.btn.ghost{background:#0f1620;border:1px solid #243042}
.btn[disabled]{opacity:.5;cursor:not-allowed}
</style>
</head>
<body>
<div class="app" id="app">
  <div class="header">
    <div class="title">Elementix ‚Äî –∞–ª—Ö–∏–º–∏—è</div>
    <div class="spacer"></div>
    <div class="stars">‚≠ê <span id="stars">0</span></div>
    <button id="openJournal" class="btn" style="margin-left:8px">–ñ—É—Ä–Ω–∞–ª</button>
  </div>

  <div class="main">
    <!-- Sticky pretty chips -->
    <div class="crumbs" id="crumbs"></div>

    <div class="bowls">
      <div class="drop" id="bA"><div class="hint">–ß–∞—à–∞ A ‚Ä¢ –ø–µ—Ä–µ—Ç–∞—â–∏ –∏–ª–∏ –∫–ª–∏–∫–Ω–∏ –∫–∞—Ä—Ç–æ—á–∫—É</div><button class="clear" data-clear="A">–û—á–∏—Å—Ç–∏—Ç—å</button></div>
      <div class="drop" id="bB"><div class="hint">–ß–∞—à–∞ B ‚Ä¢ –ø–µ—Ä–µ—Ç–∞—â–∏ –∏–ª–∏ –∫–ª–∏–∫–Ω–∏ –∫–∞—Ä—Ç–æ—á–∫—É</div><button class="clear" data-clear="B">–û—á–∏—Å—Ç–∏—Ç—å</button></div>
    </div>

    <div class="tools">
      <input id="search" placeholder="–ü–æ–∏—Å–∫ –ø–æ –∫–æ–ª–ª–µ–∫—Ü–∏–∏‚Ä¶">
      <button id="reset" class="btn">–°–±—Ä–æ—Å</button>
      <div class="count">–û—Ç–∫—Ä—ã—Ç–æ: <span id="openCount">0</span> / <span id="totalCount">0</span> ‚Ä¢ <b style="color:#6fb1ff">v125g</b></div>
    </div>

    <div class="grid" id="grid"></div>
  </div>

  <div class="dock">
    <div class="inner">
      <button id="hint" class="btn"><div class="hline1" id="h1">–ü–æ–¥—Å–∫–∞–∑–∫–∞</div><div class="hline2" id="h2">–±–µ—Å–ø–ª–∞—Ç–Ω–æ</div></button>
      <button id="mix" class="btn primary">–°–º–µ—à–∞—Ç—å</button>
      <button id="clear" class="btn">–û—á–∏—Å—Ç–∏—Ç—å —á–∞—à–∏</button>
    </div>
  </div>
</div>

<div class="modal" id="store">
  <div class="sheet">
    <h3 class="title">–ö—É–ø–∏—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É</h3>
    <div class="row"><div class="lab">–¶–µ–Ω–∞</div><div class="val">‚≠ê 10</div></div>
    <div class="row"><div class="lab">–ë–∞–ª–∞–Ω—Å</div><div class="val">‚≠ê <span id="balStars">0</span></div></div>
    <div class="row"><div class="lab">–°–ª–µ–¥—É—é—â–∞—è –±–µ—Å–ø–ª–∞—Ç–Ω–∞—è</div><div class="val" id="nextFree">‚Äî:‚Äî:‚Äî</div></div>
    <div style="color:#9fb0bf;font-size:12px;margin-top:6px">–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è ‚Äî 1 —Ä–∞–∑ –≤ —Å—É—Ç–∫–∏. –ö—É–ø–ª–µ–Ω–Ω—ã–µ –ø–æ–¥—Å–∫–∞–∑–∫–∏ —Å—É–º–º–∏—Ä—É—é—Ç—Å—è.</div>
    <div class="btns">
      <button id="storeClose" class="btn ghost">–ó–∞–∫—Ä—ã—Ç—å</button>
      <button id="storeBuy" class="btn primary">–ö—É–ø–∏—Ç—å</button>
    </div>
  </div>
</div>

<script>
const DATA = {"base": [{"id": "fire", "n": "–û–≥–æ–Ω—å", "e": "üî•", "r": "common"}, {"id": "water", "n": "–í–æ–¥–∞", "e": "üíß", "r": "common"}, {"id": "earth", "n": "–ó–µ–º–ª—è", "e": "ü™®", "r": "common"}, {"id": "air", "n": "–í–æ–∑–¥—É—Ö", "e": "üí®", "r": "common"}], "extra": {"plant": {"n": "–†–∞—Å—Ç–µ–Ω–∏–µ", "e": "üåø", "r": "common"}, "tree": {"n": "–î–µ—Ä–µ–≤–æ", "e": "üå≥", "r": "common"}, "seed": {"n": "–°–µ–º–µ–Ω–∞", "e": "üå±", "r": "common"}, "flower": {"n": "–¶–≤–µ—Ç–æ–∫", "e": "üå∏", "r": "common"}, "mushroom": {"n": "–ì—Ä–∏–±", "e": "üçÑ", "r": "common"}, "forest": {"n": "–õ–µ—Å", "e": "üå≤", "r": "rare"}, "swamp": {"n": "–ë–æ–ª–æ—Ç–æ", "e": "ü¶†", "r": "common"}, "life": {"n": "–ñ–∏–∑–Ω—å", "e": "üß¨", "r": "rare"}, "animal": {"n": "–ñ–∏–≤–æ—Ç–Ω–æ–µ", "e": "üêæ", "r": "rare"}, "fish": {"n": "–†—ã–±–∞", "e": "üêü", "r": "common"}, "bird": {"n": "–ü—Ç–∏—Ü–∞", "e": "üê¶", "r": "common"}, "human": {"n": "–ß–µ–ª–æ–≤–µ–∫", "e": "üßë", "r": "epic"}, "stone": {"n": "–ö–∞–º–µ–Ω—å", "e": "üóø", "r": "common"}, "sand": {"n": "–ü–µ—Å–æ–∫", "e": "üèñÔ∏è", "r": "common"}, "glass": {"n": "–°—Ç–µ–∫–ª–æ", "e": "ü™ü", "r": "common"}, "metal": {"n": "–ú–µ—Ç–∞–ª–ª", "e": "üî©", "r": "rare"}, "coal": {"n": "–£–≥–æ–ª—å", "e": "ü™µ", "r": "common"}, "oil": {"n": "–ù–µ—Ñ—Ç—å", "e": "üõ¢Ô∏è", "r": "rare"}, "clay": {"n": "–ì–ª–∏–Ω–∞", "e": "üß±", "r": "common"}, "brick": {"n": "–ö–∏—Ä–ø–∏—á", "e": "üß±", "r": "common"}, "lava": {"n": "–õ–∞–≤–∞", "e": "üåã", "r": "common"}, "mountain": {"n": "–ì–æ—Ä–∞", "e": "‚õ∞Ô∏è", "r": "rare"}, "canyon": {"n": "–ö–∞–Ω—å–æ–Ω", "e": "üèúÔ∏è", "r": "rare"}, "diamond": {"n": "–ê–ª–º–∞–∑", "e": "üíé", "r": "epic"}, "cloud": {"n": "–¢—É—á–∞", "e": "‚òÅÔ∏è", "r": "common"}, "rain": {"n": "–î–æ–∂–¥—å", "e": "üåßÔ∏è", "r": "common"}, "storm": {"n": "–®—Ç–æ—Ä–º", "e": "üå™Ô∏è", "r": "rare"}, "snow": {"n": "–°–Ω–µ–≥", "e": "‚ùÑÔ∏è", "r": "common"}, "ice": {"n": "–õ—ë–¥", "e": "üßä", "r": "common"}, "wind": {"n": "–í–µ—Ç–µ—Ä", "e": "üçÉ", "r": "common"}, "pressure": {"n": "–î–∞–≤–ª–µ–Ω–∏–µ", "e": "üßØ", "r": "common"}, "heat": {"n": "–ñ–∞—Ä–∞", "e": "üî•", "r": "common"}, "energy": {"n": "–≠–Ω–µ—Ä–≥–∏—è", "e": "‚ö°Ô∏è", "r": "rare"}, "lightning": {"n": "–ú–æ–ª–Ω–∏—è", "e": "üå©Ô∏è", "r": "rare"}, "sun": {"n": "–°–æ–ª–Ω—Ü–µ", "e": "‚òÄÔ∏è", "r": "rare"}, "moon": {"n": "–õ—É–Ω–∞", "e": "üåô", "r": "rare"}, "time": {"n": "–í—Ä–µ–º—è", "e": "‚è≥", "r": "epic"}, "wheat": {"n": "–ü—à–µ–Ω–∏—Ü–∞", "e": "üåæ", "r": "common"}, "flour": {"n": "–ú—É–∫–∞", "e": "ü•£", "r": "common"}, "dough": {"n": "–¢–µ—Å—Ç–æ", "e": "ü•ñ", "r": "common"}, "bread": {"n": "–•–ª–µ–±", "e": "üçû", "r": "common"}, "fruit": {"n": "–§—Ä—É–∫—Ç", "e": "üçé", "r": "common"}, "juice": {"n": "–°–æ–∫", "e": "üßÉ", "r": "common"}, "milk": {"n": "–ú–æ–ª–æ–∫–æ", "e": "ü•õ", "r": "common"}, "cheese": {"n": "–°—ã—Ä", "e": "üßÄ", "r": "common"}, "coffee": {"n": "–ö–æ—Ñ–µ", "e": "‚òï", "r": "common"}, "tea": {"n": "–ß–∞–π", "e": "üçµ", "r": "common"}, "sugar": {"n": "–°–∞—Ö–∞—Ä", "e": "üç¨", "r": "common"}, "salt": {"n": "–°–æ–ª—å", "e": "üßÇ", "r": "common"}, "meat": {"n": "–ú—è—Å–æ", "e": "ü•©", "r": "common"}, "egg": {"n": "–Ø–π—Ü–æ", "e": "ü•ö", "r": "common"}, "tool": {"n": "–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç", "e": "üõ†Ô∏è", "r": "common"}, "paper": {"n": "–ë—É–º–∞–≥–∞", "e": "üìÑ", "r": "common"}, "book": {"n": "–ö–Ω–∏–≥–∞", "e": "üìö", "r": "common"}, "screen": {"n": "–≠–∫—Ä–∞–Ω", "e": "üñ•Ô∏è", "r": "rare"}, "electricity": {"n": "–≠–ª–µ–∫—Ç—Ä–∏—á–µ—Å—Ç–≤–æ", "e": "üîå", "r": "rare"}, "wire": {"n": "–ü—Ä–æ–≤–æ–¥", "e": "üßµ", "r": "common"}, "circuit": {"n": "–°—Ö–µ–º–∞", "e": "üß©", "r": "rare"}, "battery": {"n": "–ë–∞—Ç–∞—Ä–µ—è", "e": "üîã", "r": "common"}, "engine": {"n": "–î–≤–∏–≥–∞—Ç–µ–ª—å", "e": "üõû", "r": "rare"}, "car": {"n": "–ú–∞—à–∏–Ω–∞", "e": "üöó", "r": "epic"}, "boat": {"n": "–õ–æ–¥–∫–∞", "e": "üõ∂", "r": "common"}, "ship": {"n": "–ö–æ—Ä–∞–±–ª—å", "e": "üö¢", "r": "rare"}, "computer": {"n": "–ö–æ–º–ø—å—é—Ç–µ—Ä", "e": "üíª", "r": "epic"}, "internet": {"n": "–ò–Ω—Ç–µ—Ä–Ω–µ—Ç", "e": "üåê", "r": "epic"}, "app": {"n": "–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ", "e": "üì±", "r": "epic"}, "robot": {"n": "–†–æ–±–æ—Ç", "e": "ü§ñ", "r": "epic"}, "ai": {"n": "–ò–ò", "e": "üß†", "r": "epic"}, "factory": {"n": "–§–∞–±—Ä–∏–∫–∞", "e": "üè≠", "r": "rare"}, "plastic": {"n": "–ü–ª–∞—Å—Ç–∏–∫", "e": "üß¥", "r": "common"}, "glass_fiber": {"n": "–°—Ç–µ–∫–ª–æ–≤–æ–ª–æ–∫–Ω–æ", "e": "üßµ", "r": "rare"}, "rocket": {"n": "–†–∞–∫–µ—Ç–∞", "e": "üöÄ", "r": "epic"}, "satellite": {"n": "–°–ø—É—Ç–Ω–∏–∫", "e": "üõ∞Ô∏è", "r": "epic"}, "telescope": {"n": "–¢–µ–ª–µ—Å–∫–æ–ø", "e": "üî≠", "r": "rare"}, "astronaut": {"n": "–ê—Å—Ç—Ä–æ–Ω–∞–≤—Ç", "e": "üë®‚ÄçüöÄ", "r": "epic"}, "planet": {"n": "–ü–ª–∞–Ω–µ—Ç–∞", "e": "ü™ê", "r": "epic"}, "star": {"n": "–ó–≤–µ–∑–¥–∞", "e": "‚≠ê", "r": "epic"}, "galaxy": {"n": "–ì–∞–ª–∞–∫—Ç–∏–∫–∞", "e": "üåå", "r": "epic"}, "universe": {"n": "–í—Å–µ–ª–µ–Ω–Ω–∞—è", "e": "üí´", "r": "epic"}, "gps": {"n": "GPS", "e": "üì°", "r": "epic"}, "house": {"n": "–î–æ–º", "e": "üè†", "r": "common"}, "city": {"n": "–ì–æ—Ä–æ–¥", "e": "üèôÔ∏è", "r": "rare"}, "school": {"n": "–®–∫–æ–ª–∞", "e": "üè´", "r": "common"}, "teacher": {"n": "–£—á–∏—Ç–µ–ª—å", "e": "üßë‚Äçüè´", "r": "common"}, "student": {"n": "–°—Ç—É–¥–µ–Ω—Ç", "e": "üßë‚Äçüéì", "r": "common"}, "market": {"n": "–†—ã–Ω–æ–∫", "e": "üõí", "r": "common"}, "shop": {"n": "–ú–∞–≥–∞–∑–∏–Ω", "e": "üè¨", "r": "common"}, "bank": {"n": "–ë–∞–Ω–∫", "e": "üè¶", "r": "rare"}, "money": {"n": "–î–µ–Ω—å–≥–∏", "e": "üí∞", "r": "rare"}, "hospital": {"n": "–ë–æ–ª—å–Ω–∏—Ü–∞", "e": "üè•", "r": "rare"}, "doctor": {"n": "–î–æ–∫—Ç–æ—Ä", "e": "üë®‚Äç‚öïÔ∏è", "r": "rare"}, "medicine": {"n": "–ú–µ–¥–∏—Ü–∏–Ω–∞", "e": "üíä", "r": "rare"}, "steam": {"n": "–ü–∞—Ä", "e": "‚ô®Ô∏è", "r": "common"}, "mud": {"n": "–ì—Ä—è–∑—å", "e": "üü´", "r": "common"}, "dust": {"n": "–ü—ã–ª—å", "e": "üßπ", "r": "common"}, "charcoal": {"n": "–î—Ä–µ–≤–µ—Å–Ω—ã–π —É–≥–æ–ª—å", "e": "‚ô®Ô∏è", "r": "common"}, "ash": {"n": "–ü–µ–ø–µ–ª", "e": "üß´", "r": "common"}, "smoke": {"n": "–î—ã–º", "e": "üí≠", "r": "common"}, "sandstone": {"n": "–ü–µ—Å—á–∞–Ω–∏–∫", "e": "üß±", "r": "common"}, "shore": {"n": "–ë–µ—Ä–µ–≥", "e": "üèùÔ∏è", "r": "common"}, "sea": {"n": "–ú–æ—Ä–µ", "e": "üåä", "r": "common"}, "ocean": {"n": "–û–∫–µ–∞–Ω", "e": "üåä", "r": "rare"}, "river": {"n": "–†–µ–∫–∞", "e": "üèûÔ∏è", "r": "common"}, "lake": {"n": "–û–∑–µ—Ä–æ", "e": "ü™£", "r": "common"}, "desert": {"n": "–ü—É—Å—Ç—ã–Ω—è", "e": "üèúÔ∏è", "r": "common"}, "island": {"n": "–û—Å—Ç—Ä–æ–≤", "e": "üèùÔ∏è", "r": "rare"}, "volcano": {"n": "–í—É–ª–∫–∞–Ω", "e": "üåã", "r": "rare"}, "screen_phone": {"n": "–≠–∫—Ä–∞–Ω —Ç–µ–ª–µ—Ñ–æ–Ω–∞", "e": "üì±", "r": "rare"}, "motor": {"n": "–ú–æ—Ç–æ—Ä", "e": "‚öôÔ∏è", "r": "rare"}, "propeller": {"n": "–ü—Ä–æ–ø–µ–ª–ª–µ—Ä", "e": "üåÄ", "r": "common"}, "drone": {"n": "–î—Ä–æ–Ω", "e": "üõ∏", "r": "epic"}, "motor_electric": {"n": "–≠–ª–µ–∫—Ç—Ä–æ–º–æ—Ç–æ—Ä", "e": "üîå", "r": "rare"}, "battery_pack": {"n": "–ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä", "e": "üîã", "r": "rare"}, "fuel": {"n": "–¢–æ–ø–ª–∏–≤–æ", "e": "‚õΩ", "r": "common"}, "program": {"n": "–ü—Ä–æ–≥—Ä–∞–º–º–∞", "e": "üß†", "r": "rare"}, "idea": {"n": "–ò–¥–µ—è", "e": "üí°", "r": "rare"}, "paper_roll": {"n": "–†—É–ª–æ–Ω –±—É–º–∞–≥–∏", "e": "üßª", "r": "common"}, "wood": {"n": "–î—Ä–µ–≤–µ—Å–∏–Ω–∞", "e": "ü™µ", "r": "common"}, "press": {"n": "–ü—Ä–µ—Å—Å", "e": "üóúÔ∏è", "r": "rare"}, "brick_house": {"n": "–ö–∏—Ä–ø–∏—á–Ω—ã–π –¥–æ–º", "e": "üèöÔ∏è", "r": "common"}, "concrete": {"n": "–ë–µ—Ç–æ–Ω", "e": "üß±", "r": "common"}, "steel": {"n": "–°—Ç–∞–ª—å", "e": "üõ°Ô∏è", "r": "rare"}, "alloy": {"n": "–°–ø–ª–∞–≤", "e": "üî©", "r": "rare"}, "screen_panel": {"n": "–ü–∞–Ω–µ–ª—å", "e": "ü™ü", "r": "common"}, "boat_engine": {"n": "–õ–æ–¥–æ—á–Ω—ã–π –º–æ—Ç–æ—Ä", "e": "üõ•Ô∏è", "r": "rare"}, "extra125": {"n": "–≠–ª–µ–º–µ–Ω—Ç 125", "e": "‚ú®", "r": "common"}, "extra126": {"n": "–≠–ª–µ–º–µ–Ω—Ç 126", "e": "‚ú®", "r": "common"}, "extra127": {"n": "–≠–ª–µ–º–µ–Ω—Ç 127", "e": "‚ú®", "r": "common"}, "extra128": {"n": "–≠–ª–µ–º–µ–Ω—Ç 128", "e": "‚ú®", "r": "common"}, "extra129": {"n": "–≠–ª–µ–º–µ–Ω—Ç 129", "e": "‚ú®", "r": "common"}, "extra130": {"n": "–≠–ª–µ–º–µ–Ω—Ç 130", "e": "‚ú®", "r": "common"}, "extra131": {"n": "–≠–ª–µ–º–µ–Ω—Ç 131", "e": "‚ú®", "r": "common"}, "extra132": {"n": "–≠–ª–µ–º–µ–Ω—Ç 132", "e": "‚ú®", "r": "common"}, "extra133": {"n": "–≠–ª–µ–º–µ–Ω—Ç 133", "e": "‚ú®", "r": "common"}, "extra134": {"n": "–≠–ª–µ–º–µ–Ω—Ç 134", "e": "‚ú®", "r": "common"}, "extra135": {"n": "–≠–ª–µ–º–µ–Ω—Ç 135", "e": "‚ú®", "r": "common"}, "extra136": {"n": "–≠–ª–µ–º–µ–Ω—Ç 136", "e": "‚ú®", "r": "common"}, "extra137": {"n": "–≠–ª–µ–º–µ–Ω—Ç 137", "e": "‚ú®", "r": "common"}, "extra138": {"n": "–≠–ª–µ–º–µ–Ω—Ç 138", "e": "‚ú®", "r": "common"}, "extra139": {"n": "–≠–ª–µ–º–µ–Ω—Ç 139", "e": "‚ú®", "r": "common"}, "extra140": {"n": "–≠–ª–µ–º–µ–Ω—Ç 140", "e": "‚ú®", "r": "common"}, "extra141": {"n": "–≠–ª–µ–º–µ–Ω—Ç 141", "e": "‚ú®", "r": "common"}, "extra142": {"n": "–≠–ª–µ–º–µ–Ω—Ç 142", "e": "‚ú®", "r": "common"}, "extra143": {"n": "–≠–ª–µ–º–µ–Ω—Ç 143", "e": "‚ú®", "r": "common"}, "extra144": {"n": "–≠–ª–µ–º–µ–Ω—Ç 144", "e": "‚ú®", "r": "common"}, "extra145": {"n": "–≠–ª–µ–º–µ–Ω—Ç 145", "e": "‚ú®", "r": "common"}}, "recipes": {"earth+fire": "lava", "fire+water": "steam", "earth+water": "mud", "air+earth": "dust", "air+water": "rain", "air+fire": "energy", "lava+water": "stone", "air+lava": "stone", "earth+lava": "volcano", "air+stone": "sand", "fire+sand": "glass", "air+air": "pressure", "earth+pressure": "mountain", "mud+plant": "swamp", "swamp+time": "life", "earth+life": "animal", "life+water": "fish", "animal+time": "human", "earth+plant": "tree", "air+plant": "seed", "plant+time": "forest", "plant+sun": "fruit", "tool+wheat": "flour", "flour+water": "dough", "dough+fire": "bread", "fruit+tool": "juice", "milk+time": "cheese", "stone+tool": "clay", "clay+fire": "brick", "brick+house": "brick_house", "pressure+sand": "sandstone", "sand+water": "shore", "shore+water": "sea", "sea+water": "ocean", "earth+river": "lake", "fire+stone": "metal", "metal+pressure": "steel", "air+energy": "heat", "energy+metal": "electricity", "electricity+metal": "wire", "metal+wire": "circuit", "circuit+energy": "computer", "electricity+wire": "internet", "computer+internet": "app", "electricity+glass": "screen", "paper+screen": "screen_panel", "phone+screen": "screen_phone", "magnet+metal": "motor_electric", "battery+wire": "battery_pack", "metal+tool": "engine", "engine+fuel": "rocket", "boat+engine": "boat_engine", "engine+propeller": "motor", "metal+wind": "propeller", "motor+propeller": "drone", "rocket+satellite": "gps", "human+rocket": "astronaut", "planet+star": "galaxy", "galaxy+time": "universe", "house+house": "city", "school+teacher": "student", "market+money": "shop", "hospital+medicine": "doctor", "energy+oil": "plastic", "idea+paper": "book", "pressure+stone": "diamond", "ocean+sun": "salt", "forest+time": "swamp"}};
const PRICE=10;
const SAVE_KEY='elementix-v125g';
const BASE=DATA.base, EXTRA=DATA.extra, RECIPES=DATA.recipes;
const ALL=new Map(); BASE.forEach(b=>ALL.set(b.id,b)); Object.entries(EXTRA).forEach(([id,m])=>ALL.set(id,{id,n:m.n,e:m.e,r:m.r}));

const $=id=>document.getElementById(id);
const grid=$('grid'),openCount=$('openCount'),totalCount=$('totalCount'),
      bA=$('bA'),bB=$('bB'),starsEl=$('stars'),
      mixBtn=$('mix'),clearBtn=$('clear'),
      hintBtn=$('hint'),h1=$('h1'),h2=$('h2'),
      store=$('store'),storeBuy=$('storeBuy'),storeClose=$('storeClose'),
      balStars=$('balStars'),nextFree=$('nextFree'),
      crumbs=$('crumbs');

const dayKey=()=>new Date().toISOString().slice(0,10);
let state={disc:new Set(BASE.map(x=>x.id)),order:[...BASE.map(x=>x.id)],a:null,b:null,j:[],stars:30,daily:{date:dayKey(),used:false,paid:0}};
try{ const raw=localStorage.getItem(SAVE_KEY); if(raw){ const o=JSON.parse(raw);
  state.disc=new Set(o.d||BASE.map(x=>x.id));
  state.order=Array.isArray(o.o)&&o.o.length?o.o:[...state.disc];
  state.a=o.a||null; state.b=o.b||null; state.j=Array.isArray(o.j)?o.j:[]; state.stars=Number.isFinite(o.stars)?o.stars:30; state.daily=o.daily||state.daily;
}}catch{}
if(state.daily.date!==dayKey()) state.daily={date:dayKey(),used:false,paid:0};
function save(){ localStorage.setItem(SAVE_KEY, JSON.stringify({d:[...state.disc],o:state.order,a:state.a,b:state.b,j:state.j.slice(0,200),stars:state.stars,daily:state.daily})); }

function asList(filterText=''){
  const q=(filterText||'').toLowerCase();
  const opened=[...state.order].filter(id=>ALL.has(id) && state.disc.has(id) && ALL.get(id).n.toLowerCase().includes(q));
  const locked=[...ALL.keys()].filter(id=>!state.disc.has(id) && ALL.get(id).n.toLowerCase().includes(q))
                               .sort((a,b)=>ALL.get(a).n.localeCompare(ALL.get(b).n,'ru'));
  return opened.concat(locked);
}
const tag=r=>r==='epic'?'epic':(r==='rare'?'rare':'common');
function cardHTML(id, opened){
  const it=ALL.get(id);
  const t=`<div class="tag ${tag(it.r)}">${it.r==='epic'?'–≠–ø–∏—á–µ—Å–∫–∏–π':it.r==='rare'?'–†–µ–¥–∫–∏–π':'–û–±—ã—á–Ω—ã–π'}</div>`;
  return `<div class="card ${opened?'':'locked'}" data-id="${id}" draggable="${opened}">${t}<div class="emoji">${opened?it.e:'‚ùì'}</div><div class="name">${opened?it.n:'???'}</div></div>`;
}
function renderDex(q=''){
  grid.innerHTML='';
  for(const id of asList(q)){
    const opened=state.disc.has(id);
    const wrap=document.createElement('div'); wrap.innerHTML=cardHTML(id,opened);
    const card=wrap.firstChild;
    if(opened){
      card.addEventListener('click',()=>selectByClick(id));
      card.addEventListener('dragstart',e=>{ e.dataTransfer.setData('text/plain',id); });
    }
    grid.appendChild(card);
  }
  openCount.textContent=state.disc.size; totalCount.textContent=ALL.size;
}
function bowlBlock(id){
  if(!id) return '<div class="hint">–ü–µ—Ä–µ—Ç–∞—â–∏ –∏–ª–∏ –∫–ª–∏–∫–Ω–∏ –∫–∞—Ä—Ç–æ—á–∫—É</div>';
  const it=ALL.get(id);
  return `<div class="selection"><div class="emoji">${it.e}</div><div class="name">${it.n}</div></div>`;
}
function renderBowls(){ bA.innerHTML=bowlBlock(state.a); bB.innerHTML=bowlBlock(state.b); renderCrumbs(); }
[bA,bB].forEach((b,ix)=>{
  b.addEventListener('dragover',e=>e.preventDefault());
  b.addEventListener('drop',e=>{ e.preventDefault(); const id=e.dataTransfer.getData('text/plain'); if(ix===0) state.a=id; else state.b=id; renderBowls(); save(); });
});
document.addEventListener('click',e=>{
  const x=e.target.closest('[data-clear="A"]'); const y=e.target.closest('[data-clear="B"]');
  if(x){ state.a=null; renderBowls(); save(); }
  if(y){ state.b=null; renderBowls(); save(); }
});
function selectByClick(id){ if(!state.a) state.a=id; else if(!state.b) state.b=id; else { state.a=id; state.b=null; } renderBowls(); save(); }
$('search').addEventListener('input',(()=>{ let t; return ()=>{ clearTimeout(t); t=setTimeout(()=>renderDex($('search').value),120);} })());
$('reset').addEventListener('click',()=>{ localStorage.removeItem(SAVE_KEY); location.reload(); });

// Pretty sticky tokens (click to clear)
function renderCrumbs(){
  const parts=[];
  if(state.a){ const it=ALL.get(state.a); parts.push(`<div class="token glow" data-tip="A" title="${it.n}" data-bowl="A"><div class="emo">${it.e}</div></div>`); }
  if(state.b){ const it=ALL.get(state.b); parts.push(`<div class="token glow" data-tip="B" title="${it.n}" data-bowl="B"><div class="emo">${it.e}</div></div>`); }
  crumbs.innerHTML = parts.join('') || '<div style="color:#9fb0bf;font-size:12px;padding:2px 6px">–í—ã–±–µ—Ä–∏ 2 —ç–ª–µ–º–µ–Ω—Ç–∞‚Ä¶</div>';
  [...crumbs.querySelectorAll('.token')].forEach(t=>{
    t.addEventListener('click',()=>{
      const b=t.getAttribute('data-bowl');
      if(b==='A') state.a=null; else state.b=null;
      renderBowls(); save();
    });
  });
}

// Toast
function toast(msg){ const t=document.createElement('div'); t.className='toast'; t.textContent=msg; document.body.appendChild(t); setTimeout(()=>t.remove(),1400); }

// Mix
mixBtn.addEventListener('click',()=>{
  if(!state.a||!state.b){ toast('–ù—É–∂–Ω–æ 2 —ç–ª–µ–º–µ–Ω—Ç–∞'); return; }
  const key=[state.a,state.b].sort().join('+');
  const out=RECIPES[key];
  if(!out){ toast('–ü—É—Å—Ç–∞—è —Ä–µ–∞–∫—Ü–∏—è‚Ä¶'); return; }
  const wasNew=!state.disc.has(out);
  state.disc.add(out);
  if(wasNew){ state.order=state.order.filter(x=>x!==out); state.order.push(out); }
  state.a=null; state.b=null;
  renderBowls();
  renderDex($('search').value);
  const it=ALL.get(out) || {e:'‚ú®',n:out};
  toast((wasNew?'–ù–æ–≤—ã–π —ç–ª–µ–º–µ–Ω—Ç: ':'')+it.e+' '+it.n);
  if(wasNew){ state.j.unshift({id:out,t:Date.now()}); }
  save();
});

clearBtn.addEventListener('click',()=>{ state.a=null; state.b=null; renderBowls(); save(); });

// Hints + store (stacked)
const msToNextDay=()=>{const now=new Date(); const next=new Date(now.getFullYear(),now.getMonth(),now.getDate()+1,0,0,0,0); return next-now; }
const fmt=ms=>{ const s=Math.max(0,Math.floor(ms/1000)); const h=String(Math.floor(s/3600)).padStart(2,'0'); const m=String(Math.floor(s%3600/60)).padStart(2,'0'); const ss=String(s%60)%60; return `${h}:${String(m).padStart(2,'0')}:${String(ss).padStart(2,'0')}`;}
function reflectHint(){
  starsEl.textContent=state.stars;
  if(!state.daily.used){ h1.textContent='–ü–æ–¥—Å–∫–∞–∑–∫–∞'; h2.textContent='–±–µ—Å–ø–ª–∞—Ç–Ω–æ'; }
  else if(state.daily.paid>0){ h1.textContent='–ï—â—ë –ø–æ–¥—Å–∫–∞–∑–∫–∞'; h2.textContent='‚≠ê '+state.daily.paid; }
  else { h1.textContent='–ö—É–ø–∏—Ç—å –ø–æ–¥—Å–∫–∞–∑–∫—É'; h2.textContent='‚≠ê '+PRICE; }
}
function findHint(){
  for(const [pair,out] of Object.entries(RECIPES)){
    const [x,y]=pair.split('+');
    if(state.disc.has(x)&&state.disc.has(y)&&!state.disc.has(out)) return `${ALL.get(x)?.n||x} + ${ALL.get(y)?.n||y}`;
  }
  return null;
}
function useHint(paid){
  const s=findHint(); if(!s){ toast('–ü–æ—Ö–æ–∂–µ, –≤—Å—ë –æ—Ç–∫—Ä—ã—Ç–æ –∏–∑ –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ.'); return; }
  if(paid){ if(state.daily.paid<=0){ toast('–ù–µ—Ç –æ–ø–ª–∞—á–µ–Ω–Ω—ã—Ö –ø–æ–¥—Å–∫–∞–∑–æ–∫'); return; } state.daily.paid--; }
  else { if(state.daily.used){ toast('–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è —É–∂–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∞'); return; } state.daily.used=true; }
  save(); toast('–ü–æ–ø—Ä–æ–±—É–π: '+s); reflectHint();
}

let storeTimer=null;
function openStore(){
  balStars.textContent = state.stars;
  nextFree.textContent = fmt(msToNextDay());
  storeBuy.disabled = state.stars < PRICE;
  if(storeTimer) clearInterval(storeTimer);
  storeTimer = setInterval(()=>{ nextFree.textContent = fmt(msToNextDay()); }, 1000);
  store.style.display='block';
}
function closeStore(){ store.style.display='none'; if(storeTimer){ clearInterval(storeTimer); storeTimer=null; } }
storeClose.addEventListener('click', closeStore);
store.addEventListener('click', (e)=>{ if(e.target===store) closeStore(); });
storeBuy.addEventListener('click', ()=>{ if(state.stars < PRICE) return; state.stars -= PRICE; state.daily.paid++; save(); reflectHint(); balStars.textContent = state.stars; toast('–ö—É–ø–ª–µ–Ω–∞ –ø–æ–¥—Å–∫–∞–∑–∫–∞ –∑–∞ ‚≠ê'+PRICE); closeStore(); });

hintBtn.addEventListener('click',()=>{ if(!state.daily.used) useHint(false); else if(state.daily.paid>0) useHint(true); else openStore(); });

function init(){ renderDex(); renderBowls(); reflectHint(); renderCrumbs(); }
init();
</script>
</body>
</html>
